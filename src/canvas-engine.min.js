(function(e){var k=e.MouseReader,d=e.KeyReader,c=e.AppObject;var f=function(l,m){Object.keys(l).forEach(function(n){if(m[n]===undefined){m[n]=l[n]}});return m};var j={};var b={regex:{PERCENT:/^[0-9]+(\.[0-9]+)?%$/,INT:/^[0-9]+$/,NUMBER:/^-?[0-9]+(\.[0-9]+)?$/,HEXADECIMAL_COLOR:/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?$/,RGB_COLOR:/^rgb\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\)$/,RGBA_COLOR:/^rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(0.[0-9]{1,2}|1)\)$/},validateInt:function(l,m){if(b.regex.INT.test(m)){return m}return l},validateNumber:function(l,m){if(_.isNumber(m)){return m}return l},validateObject:function(l,m){if(_.isObject(m)){return m}return l},validateColor:function(l,m){var n=b.regex;if(m==="transparent"||n.HEXADECIMAL_COLOR.test(m)||n.RGB_COLOR.test(m)||n.RGBA_COLOR.test(m)){return m}return l},validateString:function(l,m){if(_.isString(m)){return m}return l},validateArray:function(l,m){if(_.isArray(m)){return m}return l},validateBoolean:function(l,m){if(_.isBoolean(m)){return m}return l},validateFunction:function(l,m){if(_.isFunction(m)){return m}return l},validateElement:function(l,m){if(_.isElement(m)){return m}return l},isPercent:function(l){return this.regex.PERCENT.test(l)},isInt:function(l){return b.regex.INT.test(l)},isNumber:function(l){}};var h={};h.dot=function(l,m){return Object.keys(l).reduce(function(n,o){return n+l[o]*m[o]},0)};h.vxv=function(l,n){var m={};Object.keys(l).forEach(function(o){m[o]=l[o]*n[o]});return m};h.vdv=function(l,n){var m={};Object.keys(l).forEach(function(o){m[o]=l[o]/n[o]});return m};h.vpv=function(l,n){var m={};Object.keys(l).forEach(function(o){m[o]=l[o]+n[o]});return m};h.vmv=function(l,n){var m={};Object.keys(l).forEach(function(o){m[o]=l[o]-n[o]});return m};h.sxv=function(n,l){var m={};Object.keys(l).forEach(function(o){m[o]=l[o]*n});return m};h.sdv=function(n,l){var m={};Object.keys(l).forEach(function(o){m[o]=l[o]/n});return m};h.mxv=function(n,l){return n.animation(function(m){return h.dot(m,l)})};h.cross2=function(l,m){return l.x*m.y-l.y*m.x};h.norm=function(l){return h.sqrt(h.dot(l,l))};h.normalize=function(l){return h.sxv(1/h.norm(l),l)};h.med=function(n,m){var l={};Object.keys(n).forEach(function(o){l[o]=(n[o]+m[o])/2});return l};h.rotate=function(q,p,n){var m=h.degreeToRadians(p);n=n===undefined?{x:0,y:0}:n;var r=Math.cos(m);var o=Math.sin(m);var l=q.x-n.x;var s=q.y-n.y;return[(l*r-s*o)+n.x,(s*r+l*o)+n.y]};h.degreeToRadians=function(l){return l*(Math.PI/180)};h.degreeFromVec=function(m,l){var n=h.radiansFromVec(m,l);return h.radiansToDegree(n)};h.radiansFromVec=function(p,o){var n=h.dot(p,o);var m=h.norm(p);var l=h.norm(o);return Math.acos(n/(m*l))};h.radiansToDegree=function(l){return l*(180/Math.PI)};h.distance=function(m,l){return Math.sqrt(Object.keys(m).reduce(function(n,o){return n+Math.pow(m[o]-l[o],2)},0))};h.clockWiseDegreeFromVec=function(m){var l={x:0,y:-1};var n=h.degreeFromVec(m,l);if(m.x<0){n=360-n}return n};h.proportional=function(o,m,l){var n=1;if(m<l){n=l/m;l=o;m=l/n}else{if(m>l){n=m/l;m=o;l=m/n}else{m=o;l=o}}return[m,l]};var a=function(m){var l=this;l.red=0;l.blue=0;l.green=0;l.alpha=1;c.call(l);l.set(m)};a.prototype=Object.create(c.prototype);a.constructor=a;a.prototype.isTransparent=function(){return this.alpha===0};a.random=function(m){m=m===undefined?false:m;var l=new a({red:Math.floor(Math.random()*255),blue:Math.floor(Math.random()*255),green:Math.floor(Math.random()*255),opacity:Math.random()});if(m){return l.toRGBA()}return l.toHEX()};a.prototype.toRGB=function(){var l=this;if(l.isTransparent()){return"transparent"}return"rgb("+l.red+","+l.blue+","+l.green+")"};a.prototype.toRGBA=function(){var l=this;if(l.isTransparent()){return"transparent"}return"rgba("+l.red+","+l.blue+","+l.green+","+l.alpha+")"};a.prototype.toHEX=function(){var m=this;if(m.isTransparent()){return"transparent"}var o=m.red.toString(16);var n=m.blue.toString(16);var l=m.green.toString(16);o=o.length<2?o+"0":o;n=n.length<2?n+"0":n;l=l.length<2?l+"0":l;return("#"+o+n+l).toUpperCase()};a.prototype.toString=function(){var l=this;if(l.isTransparent()){return"transparent"}return l.toRGBA()};a.prototype.reverse=function(){var l=this;l.red=l.red<128?128+(128-l.red):128-(l.red-128);l.blue=l.blue<128?128+(128-l.blue):128-(l.blue-128);l.green=l.green<128?128+(128-l.green):128-(l.green-128);return l};a.asName=function(){var l=this;if(l.isTransparent()){return"transparent"}for(var m in a.Name){if(a.Name[m]===l.toHEX()){return m}}return l.toHEX()};a.Name={Snow:"#FFFAFA",GhostWhite:"#F8F8FF",WhiteSmoke:"#F5F5F5",Gainsboro:"#DCDCDC",FloralWhite:"#FFFAF0",OldLace:"#FDF5E6",Linen:"#FAF0E6",AntiqueWhite:"#FAEBD7",PapayaWhip:"#FFEFD5",BlanchedAlmond:"#FFEBCD",Bisque:"#FFE4C4",PeachPuff:"#FFDAB9",NavajoWhite:"#FFDEAD",Moccasin:"#FFE4B5",Cornsilk:"#FFF8DC",Ivory:"#FFFFF0",LemonChiffon:"#FFFACD",Seashell:"#FFF5EE",Honeydew:"#F0FFF0",MintCream:"#F5FFFA",Azure:"#F0FFFF",AliceBlue:"#F0F8FF",lavender:"#E6E6FA",LavenderBlush:"#FFF0F5",MistyRose:"#FFE4E1",White:"#FFFFFF",Black:"#000000",DarkSlateGray:"#2F4F4F",DimGrey:"#696969",SlateGrey:"#708090",LightSlateGray:"#778899",Grey:"#BEBEBE",LightGray:"#D3D3D3",MidnightBlue:"#191970",NavyBlue:"#000080",CornflowerBlue:"#6495ED",DarkSlateBlue:"#483D8B",SlateBlue:"#6A5ACD",MediumSlateBlue:"#7B68EE",LightSlateBlue:"#8470FF",MediumBlue:"#0000CD",RoyalBlue:"#4169E1",Blue:"#0000FF",DodgerBlue:"#1E90FF",DeepSkyBlue:"#00BFFF",SkyBlue:"#87CEEB",LightSkyBlue:"#87CEFA",SteelBlue:"#4682B4",LightSteelBlue:"#B0C4DE",LightBlue:"#ADD8E6",PowderBlue:"#B0E0E6",PaleTurquoise:"#AFEEEE",DarkTurquoise:"#00CED1",MediumTurquoise:"#48D1CC",Turquoise:"#40E0D0",Cyan:"#00FFFF",LightCyan:"#E0FFFF",CadetBlue:"#5F9EA0",MediumAquamarine:"#66CDAA",Aquamarine:"#7FFFD4",DarkGreen:"#006400",DarkOliveGreen:"#556B2F",DarkSeaGreen:"#8FBC8F",SeaGreen:"#2E8B57",MediumSeaGreen:"#3CB371",LightSeaGreen:"#20B2AA",PaleGreen:"#98FB98",SpringGreen:"#00FF7F",LawnGreen:"#7CFC00",Green:"#00FF00",Chartreuse:"#7FFF00",MedSpringGreen:"#00FA9A",GreenYellow:"#ADFF2F",LimeGreen:"#32CD32",YellowGreen:"#9ACD32",ForestGreen:"#228B22",OliveDrab:"#6B8E23",DarkKhaki:"#BDB76B",PaleGoldenrod:"#EEE8AA",LtGoldenrodYello:"#FAFAD2",LightYellow:"#FFFFE0",Yellow:"#FFFF00",Gold:"#FFD700",LightGoldenrod:"#EEDD82",goldenrod:"#DAA520",DarkGoldenrod:"#B8860B",RosyBrown:"#BC8F8F",IndianRed:"#CD5C5C",SaddleBrown:"#8B4513",Sienna:"#A0522D",Peru:"#CD853F",Burlywood:"#DEB887",Beige:"#F5F5DC",Wheat:"#F5DEB3",SandyBrown:"#F4A460",Tan:"#D2B48C",Chocolate:"#D2691E",Firebrick:"#B22222",Brown:"#A52A2A",DarkSalmon:"#E9967A",Salmon:"#FA8072",LightSalmon:"#FFA07A",Orange:"#FFA500",DarkOrange:"#FF8C00",Coral:"#FF7F50",LightCoral:"#F08080",Tomato:"#FF6347",OrangeRed:"#FF4500",Red:"#FF0000",HotPink:"#FF69B4",DeepPink:"#FF1493",Pink:"#FFC0CB",LightPink:"#FFB6C1",PaleVioletRed:"#DB7093",Maroon:"#B03060",MediumVioletRed:"#C71585",VioletRed:"#D02090",Magenta:"#FF00FF",Violet:"#EE82EE",Plum:"#DDA0DD",Orchid:"#DA70D6",MediumOrchid:"#BA55D3",DarkOrchid:"#9932CC",DarkViolet:"#9400D3",BlueViolet:"#8A2BE2",Purple:"#A020F0",MediumPurple:"#9370DB",Thistle:"#D8BFD8",Snow1:"#FFFAFA",Snow2:"#EEE9E9",Snow3:"#CDC9C9",Snow4:"#8B8989",Seashell1:"#FFF5EE",Seashell2:"#EEE5DE",Seashell3:"#CDC5BF",Seashell4:"#8B8682",AntiqueWhite1:"#FFEFDB",AntiqueWhite2:"#EEDFCC",AntiqueWhite3:"#CDC0B0",AntiqueWhite4:"#8B8378",Bisque1:"#FFE4C4",Bisque2:"#EED5B7",Bisque3:"#CDB79E",Bisque4:"#8B7D6B",PeachPuff1:"#FFDAB9",PeachPuff2:"#EECBAD",PeachPuff3:"#CDAF95",PeachPuff4:"#8B7765",NavajoWhite1:"#FFDEAD",NavajoWhite2:"#EECFA1",NavajoWhite3:"#CDB38B",NavajoWhite4:"#8B795E",LemonChiffon1:"#FFFACD",LemonChiffon2:"#EEE9BF",LemonChiffon3:"#CDC9A5",LemonChiffon4:"#8B8970",Cornsilk1:"#FFF8DC",Cornsilk2:"#EEE8CD",Cornsilk3:"#CDC8B1",Cornsilk4:"#8B8878",Ivory1:"#FFFFF0",Ivory2:"#EEEEE0",Ivory3:"#CDCDC1",Ivory4:"#8B8B83",Honeydew1:"#F0FFF0",Honeydew2:"#E0EEE0",Honeydew3:"#C1CDC1",Honeydew4:"#838B83",LavenderBlush1:"#FFF0F5",LavenderBlush2:"#EEE0E5",LavenderBlush3:"#CDC1C5",LavenderBlush4:"#8B8386",SlateGray4:"#6C7B8B",LightSteelBlue1:"#CAE1FF",LightSteelBlue2:"#BCD2EE",LightSteelBlue3:"#A2B5CD",LightSteelBlue4:"#6E7B8B",LightBlue1:"#BFEFFF",LightBlue2:"#B2DFEE",LightBlue3:"#9AC0CD",LightBlue4:"#68838B",LightCyan1:"#E0FFFF",LightCyan2:"#D1EEEE",LightCyan3:"#B4CDCD",LightCyan4:"#7A8B8B",PaleTurquoise1:"#BBFFFF",PaleTurquoise2:"#AEEEEE",PaleTurquoise3:"#96CDCD",PaleTurquoise4:"#668B8B",CadetBlue1:"#98F5FF",CadetBlue2:"#8EE5EE",CadetBlue3:"#7AC5CD",CadetBlue4:"#53868B",Turquoise1:"#00F5FF",Turquoise2:"#00E5EE",Turquoise3:"#00C5CD",Turquoise4:"#00868B",Cyan1:"#00FFFF",Cyan2:"#00EEEE",Cyan3:"#00CDCD",Cyan4:"#008B8B",DarkSlateGray1:"#97FFFF",DarkSlateGray2:"#8DEEEE",DarkSlateGray3:"#79CDCD",DarkSlateGray4:"#528B8B",Aquamarine1:"#7FFFD4",Aquamarine2:"#76EEC6",Aquamarine3:"#66CDAA",Aquamarine4:"#458B74",DarkSeaGreen1:"#C1FFC1",DarkSeaGreen2:"#B4EEB4",DarkSeaGreen3:"#9BCD9B",DarkSeaGreen4:"#698B69",SeaGreen1:"#54FF9F",SeaGreen2:"#4EEE94",MistyRose1:"#FFE4E1",MistyRose2:"#EED5D2",MistyRose3:"#CDB7B5",MistyRose4:"#8B7D7B",Azure1:"#F0FFFF",Azure2:"#E0EEEE",Azure3:"#C1CDCD",Azure4:"#838B8B",SlateBlue1:"#836FFF",SlateBlue2:"#7A67EE",SlateBlue3:"#6959CD",SlateBlue4:"#473C8B",RoyalBlue1:"#4876FF",RoyalBlue2:"#436EEE",RoyalBlue3:"#3A5FCD",RoyalBlue4:"#27408B",Blue1:"#0000FF",Blue2:"#0000EE",Blue3:"#0000CD",Blue4:"#00008B",DodgerBlue1:"#1E90FF",DodgerBlue2:"#1C86EE",DodgerBlue3:"#1874CD",DodgerBlue4:"#104E8B",SteelBlue1:"#63B8FF",SteelBlue2:"#5CACEE",SteelBlue3:"#4F94CD",SteelBlue4:"#36648B",DeepSkyBlue1:"#00BFFF",DeepSkyBlue2:"#00B2EE",DeepSkyBlue3:"#009ACD",DeepSkyBlue4:"#00688B",SkyBlue1:"#87CEFF",SkyBlue2:"#7EC0EE",SkyBlue3:"#6CA6CD",SkyBlue4:"#4A708B",LightSkyBlue1:"#B0E2FF",LightSkyBlue2:"#A4D3EE",LightSkyBlue3:"#8DB6CD",LightSkyBlue4:"#607B8B",SlateGray1:"#C6E2FF",SlateGray2:"#B9D3EE",SlateGray3:"#9FB6CD",Firebrick4:"#8B1A1A",Brown1:"#FF4040",Brown2:"#EE3B3B",Brown3:"#CD3333",Brown4:"#8B2323",Salmon1:"#FF8C69",Salmon2:"#EE8262",Salmon3:"#CD7054",Salmon4:"#8B4C39",LightSalmon1:"#FFA07A",LightSalmon2:"#EE9572",LightSalmon3:"#CD8162",LightSalmon4:"#8B5742",Orange1:"#FFA500",Orange2:"#EE9A00",Orange3:"#CD8500",Orange4:"#8B5A00",DarkOrange1:"#FF7F00",DarkOrange2:"#EE7600",DarkOrange3:"#CD6600",DarkOrange4:"#8B4500",Coral1:"#FF7256",Coral2:"#EE6A50",Coral3:"#CD5B45",Coral4:"#8B3E2F",Tomato1:"#FF6347",Tomato2:"#EE5C42",Tomato3:"#CD4F39",Tomato4:"#8B3626",OrangeRed1:"#FF4500",OrangeRed2:"#EE4000",OrangeRed3:"#CD3700",OrangeRed4:"#8B2500",Red1:"#FF0000",Red2:"#EE0000",Red3:"#CD0000",Red4:"#8B0000",DeepPink1:"#FF1493",DeepPink2:"#EE1289",DeepPink3:"#CD1076",DeepPink4:"#8B0A50",HotPink1:"#FF6EB4",HotPink2:"#EE6AA7",Gold2:"#EEC900",HotPink3:"#CD6090",HotPink4:"#8B3A62",Pink1:"#FFB5C5",Pink2:"#EEA9B8",Pink3:"#CD919E",Pink4:"#8B636C",LightPink1:"#FFAEB9",LightPink2:"#EEA2AD",LightPink3:"#CD8C95",LightPink4:"#8B5F65",PaleVioletRed1:"#FF82AB",PaleVioletRed2:"#EE799F",PaleVioletRed3:"#CD6889",PaleVioletRed4:"#8B475D",Maroon1:"#FF34B3",Maroon2:"#EE30A7",Maroon3:"#CD2990",Maroon4:"#8B1C62",VioletRed1:"#FF3E96",VioletRed2:"#EE3A8C",VioletRed3:"#CD3278",VioletRed4:"#8B2252",Magenta1:"#FF00FF",Magenta2:"#EE00EE",Magenta3:"#CD00CD",Magenta4:"#8B008B",Orchid1:"#FF83FA",Orchid2:"#EE7AE9",Orchid3:"#CD69C9",Orchid4:"#8B4789",Plum1:"#FFBBFF",Plum2:"#EEAEEE",Plum3:"#CD96CD",Plum4:"#8B668B",MediumOrchid1:"#E066FF",MediumOrchid2:"#D15FEE",MediumOrchid3:"#B452CD",MediumOrchid4:"#7A378B",DarkOrchid1:"#BF3EFF",DarkOrchid2:"#B23AEE",DarkOrchid3:"#9A32CD",DarkOrchid4:"#68228B",Purple1:"#9B30FF",Purple2:"#912CEE",SeaGreen3:"#43CD80",SeaGreen4:"#2E8B57",PaleGreen1:"#9AFF9A",PaleGreen2:"#90EE90",PaleGreen3:"#7CCD7C",PaleGreen4:"#548B54",SpringGreen1:"#00FF7F",SpringGreen2:"#00EE76",SpringGreen3:"#00CD66",SpringGreen4:"#008B45",Green1:"#00FF00",Green2:"#00EE00",Green3:"#00CD00",Green4:"#008B00",Chartreuse1:"#7FFF00",Chartreuse2:"#76EE00",Chartreuse3:"#66CD00",Chartreuse4:"#458B00",OliveDrab1:"#C0FF3E",OliveDrab2:"#B3EE3A",OliveDrab3:"#9ACD32",OliveDrab4:"#698B22",DarkOliveGreen1:"#CAFF70",DarkOliveGreen2:"#BCEE68",DarkOliveGreen3:"#A2CD5A",DarkOliveGreen4:"#6E8B3D",Khaki1:"#FFF68F",Khaki2:"#EEE685",Khaki3:"#CDC673",Khaki4:"#8B864E",LightGoldenrod1:"#FFEC8B",LightGoldenrod2:"#EEDC82",LightGoldenrod3:"#CDBE70",LightGoldenrod4:"#8B814C",LightYellow1:"#FFFFE0",LightYellow2:"#EEEED1",LightYellow3:"#CDCDB4",LightYellow4:"#8B8B7A",Yellow1:"#FFFF00",Yellow2:"#EEEE00",Yellow3:"#CDCD00",Yellow4:"#8B8B00",Gold1:"#FFD700",Gold3:"#CDAD00",Gold4:"#8B7500",Goldenrod1:"#FFC125",Goldenrod2:"#EEB422",Goldenrod3:"#CD9B1D",Goldenrod4:"#8B6914",DarkGoldenrod1:"#FFB90F",DarkGoldenrod2:"#EEAD0E",DarkGoldenrod3:"#CD950C",DarkGoldenrod4:"#8B658B",RosyBrown1:"#FFC1C1",RosyBrown2:"#EEB4B4",RosyBrown3:"#CD9B9B",RosyBrown4:"#8B6969",IndianRed1:"#FF6A6A",IndianRed2:"#EE6363",IndianRed3:"#CD5555",IndianRed4:"#8B3A3A",Sienna1:"#FF8247",Sienna2:"#EE7942",Sienna3:"#CD6839",Sienna4:"#8B4726",Burlywood1:"#FFD39B",Burlywood2:"#EEC591",Burlywood3:"#CDAA7D",Burlywood4:"#8B7355",Wheat1:"#FFE7BA",Wheat2:"#EED8AE",Wheat3:"#CDBA96",Wheat4:"#8B7E66",Tan1:"#FFA54F",Purple3:"#7D26CD",Purple4:"#551A8B",MediumPurple1:"#AB82FF",MediumPurple2:"#9F79EE",MediumPurple3:"#8968CD",MediumPurple4:"#5D478B",Thistle1:"#FFE1FF",Thistle2:"#EED2EE",Thistle3:"#CDB5CD",Thistle4:"#8B7B8B",grey11:"#1C1C1C",grey21:"#363636",grey31:"#4F4F4F",grey41:"#696969",grey51:"#828282",grey61:"#9C9C9C",grey71:"#B5B5B5",gray81:"#CFCFCF",gray91:"#E8E8E8",DarkGrey:"#A9A9A9",DarkBlue:"#00008B",DarkCyan:"#008B8B",DarkMagenta:"#8B008B",DarkRed:"#8B0000",LightGreen:"#90EE90",Chocolate3:"#CD661D",Chocolate4:"#8B4513",Firebrick1:"#FF3030",Firebrick2:"#EE2C2C",Firebrick3:"#CD2626",Tan2:"#EE9A49",Tan3:"#CD853F",Tan4:"#8B5A2B",Chocolate1:"#FF7F24",Chocolate2:"#EE7621"};a.Patterns={HEXADECIMAL:/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?$/,RGB:/^rgb\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\)$/,RGBA:/^rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(0.[0-9]{1,2}|1)\)$/,NAME:/^[A-Z][a-zA-z0-9]{2,15}$/};a.isColor=function(l){l=a.parse(l);return l!==null};a.parse=function(q){var n=null;if(typeof q==="string"){var p;var o;var l;if(q==="transparent"){n=new a({alpha:0})}else{if(a.Patterns.HEXADECIMAL.test(q)){q=q.substr(q.indexOf("#")+1,q.length);p=parseInt(q.substr(0,2),16);o=parseInt(q.substr(2,2),16);l=parseInt(q.substr(4,2),16);n=new a({red:p,blue:o,green:o})}else{if(a.Patterns.RGB.test(q)){q=q.replace("rgb(","").replace(")","").split(",");p=parseInt(q[0]);o=parseInt(q[1]);l=parseInt(q[2]);n=new a({red:p,blue:l,green:o})}else{if(a.Patterns.RGBA.test(q)){q=q.replace("rgba(","").replace(")","").split(",");p=parseInt(q[0]);o=parseInt(q[1]);l=parseInt(q[2]);var m=parseFloat(q[3]);n=new a({red:p,blue:l,green:o,alpha:m})}else{if(a.Patterns.NAME.test(q)){n=a.parse(a.Name[q])}}}}}}return n};var i=function(n,m){console.log("Canvas Layer initialize...");var l=this;l.type="layer";l.context=null;l.element=null;l.canvas=m;l.zIndex=0;l.width=300;l.height=300;l.left=0;l.top=0;l.savedStates=[];l.name="";l.mouseReader=null;l.opacity=1;l.visible=true;l.backgroundColor="transparent";l.transparentRegex=/^\s*transparent\s*|rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*0\s*\)\s*$/;c.call(l);i.bindProperties.apply(l);l.set(n)};i.prototype=Object.create(c.prototype);i.prototype.constructor=i;i.defaultValues={rect:{x:0,y:0,width:10,height:10,backgroundColor:"transparent",borderColor:"black",opacity:100,origin:{x:0,y:0}},circle:{x:0,y:0,radius:10,backgroundColor:"transparent",borderColor:"black",opacity:100,origin:{x:0,y:0}},polygon:{backgroundColor:"transparent",borderColor:"black",origin:{x:0,y:0},opacity:100,points:[]},image:{image:null,sx:0,sy:0,sWidth:"auto",sHeight:"auto",dx:0,dy:0,dWidth:"auto",dHeight:"auto"}};i.bindProperties=function(){var l=this;l._onChange("zIndex",function(m){$(l.getElement()).css({zIndex:m}).data("zindex",m)});l._onChange("opacity",function(m){$(l.getElement()).css({opacity:m}).data("opacity",m)});l._onChange("visible",function(m){if(m){l.show()}else{l.hide()}$(l.getElement()).data("visible",m)});l._onChange("width",function(m){$(l.getElement()).prop("width",m)});l._onChange("height",function(m){$(l.getElement()).prop("height",m)});l._onChange("name",function(m){if(m.length===0){$(l.getElement()).removeAttr("data-name").data("name","")}else{$(l.getElement()).data("name",m)}});l._onChange("left",function(m){$(l.getElement()).css({left:m}).data("left",m)});l._onChange("top",function(m){$(l.getElement()).css({top:m}).data("top",m)});l._onChange("backgroundColor",function(m){$(l.getElement()).css({backgroundColor:m}).data("backgroundColor",m)});l._onChange("element",function(m){l.context=null})};i.prototype.getVisibleArea=function(){var n=this;var o=Math.min(n.width,n.canvas.getWidth());var m=Math.min(n.height,n.canvas.getHeight());var l=Math.abs(n.canvas.viewX);var p=Math.abs(n.canvas.viewY);return{x:l,y:p,width:o,height:m}};i.prototype.isSetVisible=function(m){var l=this;var n=l.getVisibleArea();return !(m.x+m.width<n.x||n.x+n.width<m.x||m.y+m.height<n.y||n.y+n.height<m.y)};i.prototype.show=function(){var l=this;$(l.getElement()).css({visibility:"visible"});return l};i.prototype.hide=function(){var l=this;$(l.getElement()).css({visibility:"hidden"});return l};i.prototype.saveState=function(o){var m=this;var n=m.getElement().toDataURL("image/png");var l=document.createElement("img");l.src=n;m.savedStates[o]=l;return m};i.prototype.restoreState=function(m){var l=this;var n=l.savedStates[m];if(n!==undefined){l.getContext().drawImage(n,0,0)}return l};i.prototype.clearStates=function(){var l=this;l.savedStates=[];return l};i.prototype.getElement=function(){var l=this;if(l.element===null){l.element=document.createElement("canvas");$(l.element).css({pointerEvents:"none",userSelect:"none",position:"absolute",left:l.left,top:l.top,backgroundColor:l.backgroundColor,opacity:l.opacity})}return l.element};i.prototype.getContext=function(){var l=this;if(l.context===null){l.context=l.getElement().getContext("2d");if(l.context.setLineDash===undefined){l.context.setLineDash=function(){}}}return l.context};i.prototype.destroy=function(){var l=this;$(l.element).remove();if(l.canvas.layers[l.zIndex]!==undefined){delete l.canvas.layers[l.zIndex]}};i.prototype.drawImage=function(){var l=this;var m=l.getContext();m.drawImage.apply(m,arguments);return l};i.prototype.clear=function(){var l=this;l.getContext().clearRect(0,0,l.width,l.height);return l};i.prototype.drawAnimation=function(m){var l=this;l.clearRect({x:m.x,y:m.y,width:m.width,height:m.height});if(m.frames[m.indexFrame]!==undefined){var n=m.frames[m.indexFrame];l.image(n)}return l};i.prototype.getPixel=function(o,m){var l=this;var n=l.getContext();var q=n.getImageData(o,m,1,1).data;return new a({red:q[0],green:q[1],blue:q[2],alpha:q[3]})};i.prototype.image=function(w){var u=this;w=w===undefined?i.defaultValues.image:f(i.defaultValues.image,w);var m=w.image;if(m!==null&&m instanceof HTMLImageElement){var q=w.dWidth;var n=w.dHeight;var l=w.sWidth;var o=w.sHeight;var s=w.sx;var r=w.sy;var v=w.dx;var t=w.dy;var p;if(q==="auto"&&n==="auto"){q=m.width;n=m.height}else{if(q==="auto"&&!isNaN(parseFloat(n))){q=m.width*(n/m.height)}else{if(n==="auto"&&!isNaN(parseFloat(q))){n=m.height*(q/m.width)}}}if(!isNaN(parseFloat(w.sWidth))&&w.sWidth>0){l=w.sWidth}else{if(b.isPercent(w.sWidth)){p=parseFloat(w.sWidth.replace("%",""));l=m.width*(p/100)}else{l=m.width}}if(!isNaN(parseFloat(w.sHeight))&&w.sHeight>0){o=w.sHeight}else{if(b.isPercent(w.sHeight)){p=parseFloat(w.sHeight.replace("%",""));o=m.height*(p/100)}else{o=m.height}}if(b.isPercent(w.dWidth)){p=parseFloat(w.dWidth.replace("%",""));q=l*(p/100)}else{if(!isNaN(parseFloat(w.dWidth))&&w.dWidth>0){q=w.dWidth}}if(b.isPercent(w.dHeight)){p=parseFloat(w.dHeight.replace("%",""));n=o*(p/100)}else{if(!isNaN(parseFloat(w.dHeight))&&w.dHeight>0){n=w.dHeight}}if(b.isPercent(s)){p=parseFloat(s.replace("%",""));s=m.width*(p/100)}if(b.isPercent(r)){p=parseFloat(r.replace("%",""));r=m.height*(p/100)}if(q>0&&n>0){this.getContext().drawImage(m,s,r,l,o,v,t,q,n)}}};i.prototype.circle=function(m){var l=this;m=m===undefined?i.defaultValues.circle:f(i.defaultValues.circle,m);var n=l.getContext();n.save();l.setContext(m);n.beginPath();n.arc(m.x,m.y,m.radius,0,2*Math.PI);if(n.fillStyle!==null&&!l.transparentRegex.test(n.fillStyle)){n.fill()}if(n.strokeStyle!==null&&!l.transparentRegex.test(n.strokeStyle)){n.stroke()}n.restore();return l};i.prototype.rect=function(m){var l=this;m=m===undefined?i.defaultValues.rect:_merge_options(i.defaultValues.rect,m);var n=l.getContext();n.save();l.setContext(m);if(n.fillStyle!==null&&!l.transparentRegex.test(n.fillStyle)){n.fillRect(m.x,m.y,m.width,m.height)}if(n.strokeStyle!==null&&!l.transparentRegex.test(n.strokeStyle)){n.strokeRect(m.x,m.y,m.width,m.height)}n.restore();return l};i.prototype.clearRect=function(m){var l=this;m=m===undefined?i.defaultValues.rect:f(i.defaultValues.rect,m);var n=l.getContext();n.clearRect(m.x,m.y,m.width,m.height);return l};i.prototype.clearCircle=function(m){var l=this;m=m===undefined?i.defaultValues.circle:f(i.defaultValues.circle,m);var n=l.getContext();n.save();n.arc(m.x,m.y,m.radius,0,Math.PI);n.clip();n.clearRect(m.x-m.radius,m.y-m.radius,m.radius*2,m.radius*2);n.restore();return l};i.prototype.polygon=function(m){var l=this;m=m===undefined?i.defaultValues.polygon:f(i.defaultValues.polygon,m);var q=m.points.length;var o=l.getContext();o.save();l.setContext(m);if(q>0){o.beginPath();var r=m.points[0];o.moveTo(r[0],r[1]);for(var n=1;n<q;n++){r=m.points[n];o.lineTo(r[0],r[1])}o.closePath();if(o.fillStyle!==null&&!l.transparentRegex.test(o.fillStyle)){o.fill()}if(o.strokeStyle!==null&&!l.transparentRegex.test(o.strokeStyle)){o.stroke()}}o.restore();return l};i.prototype.setContext=function(o){var n=this;var p=n.getContext();if(o.backgroundColor!==undefined){p.fillStyle=o.backgroundColor}if(o.borderColor!==undefined){p.strokeStyle=o.borderColor}if(o.lineDash!==undefined&&o.lineDash instanceof Array){p.setLineDash(o.lineDash)}if(o.opacity!==undefined){p.globalAlpha=o.opacity/100}if(o.origin!==undefined){var m=0;var l=0;if(_.isString(o.origin)){switch(o.origin){case"center":m=o.x+(o.width/2);l=o.y+(o.height/2);break}}else{if(_.isObject(o.origin)){m=o.origin.x;l=o.origin.y}}p.translate(m,l);o.x=o.x-m;o.y=o.y-l}if(o.rotate!==undefined){var q=o.rotate*(Math.PI/180);p.rotate(q)}return n};var g=function(m){console.log("initializing canvas engine...");var l=this;l.layers=[];l.height=400;l.width=400;l.viewX=0;l.viewY=0;l.lastViewX=0;l.lastViewY=0;l.width=400;l.mouseReader=null;l.keyReader=null;l.draggable=false;l.scalable=false;l.scale=1;l.container=null;c.call(l);g.bindProperties.apply(l);l.set(m);g.initialize.apply(l)};g.prototype=Object.create(c.prototype);g.prototype.constructor=g;g.initialize=function(){var l=this;var m=l.getMouseReader();m.onmousedown(3,function(){l.lastViewX=l.viewX;l.lastViewY=l.viewY});m.onmousemove(function(r){var q=this;if(l.draggable&&q.right){var z=q.lastDown.right;var v=q.lastMove;var n=h.vmv(z,v);var w=l.lastViewX-n.x;var t=l.lastViewY-n.y;var o=l.getLayer(0);var u=l.getWidth()-o.width;var s=l.getHeight()-o.height;u=u>0?0:u;s=s>0?0:s;w=Math.min(Math.max(w,u),0);t=Math.min(Math.max(t,s),0);l.set({viewX:w,viewY:t})}})};g.bindProperties=function(){var l=this;l._onChange("viewX",function(m){l.layers.forEach(function(n){$(n.getElement()).css({left:m}).data("left",m)})});l._onChange("viewY",function(m){l.layers.forEach(function(n){$(n.getElement()).css({top:m}).data("top",m)})});l._beforeSet("scale",function(){return 1});l._onChange("width",function(m){$(l.container).css({width:m})});l._onChange("height",function(m){$(l.container).css({height:m})});l._onChange("container",function(m){$(m).css({position:"relative",overflow:"hidden",width:l.width,height:l.height}).addClass("transparent-background canvas-engine").on("contextmenu",function(n){n.preventDefault()});l.getMouseReader().set({element:m});l.keyReader=null})};g.prototype.getMouseReader=function(){var l=this;if(l.mouseReader===null){l.mouseReader=new k({element:l.container})}return l.mouseReader};g.prototype.getKeyReader=function(){var l=this;if(l.keyReader===null){l.keyReader=new d(l.container)}return l.keyReader};g.prototype.getWidth=function(){return $(this.container).width()};g.prototype.getHeight=function(){return $(this.container).height()};g.prototype.clearAllLayers=function(){var l=this;this.layers.forEach(function(m){m.clear()});return l};g.prototype.applyToLayers=function(m,n){var l=this;l.layers.forEach(function(o){if(n===undefined||n.apply(o)){o.set(m)}});return l};g.prototype.createLayer=function(n,q){n=n===undefined?{}:n;var o=null;var m=this;n.zIndex=m.layers.length;var p=parseFloat(n.width);var l=parseFloat(n.height);n.width=isNaN(p)?m.getWidth():p;n.height=isNaN(l)?m.getHeight():l;if(q!==undefined){o=new q(n,m)}else{o=new i(n,m)}m.layers.push(o);if(m.container!==null&&$(m.container).length>0){$(m.container).append(o.getElement())}return o};g.prototype.getLayer=function(m){var l=this;if(l.layers[m]!==undefined){return l.layers[m]}return null};g.prototype.removeLayers=function(m){var l=this;m.forEach(function(n){l.removeLayer(n)})};g.prototype.removeLayer=function(o){var l=this;var m=-1;if(o instanceof i){m=l.layers.indexOf(o)}else{if(b.isInt(o)&&l.layers[o]!==undefined){m=o}}if(m!==-1){l.layers[m].destroy();l.layers.splice(m,1);for(var n=m;n<l.layers.length;n++){l.layers[n].set({zIndex:n})}}return l};g.prototype.getPosition=function(l){var m=this;var n={x:-m.viewX/m.scale,y:-m.viewY/m.scale};return h.vpv(h.sdv(m.scale,l),n)};j.createEngine=function(l,m){if(m===undefined){return new g(l)}return new m(l)};j.Color=a;j.AppObject=c;j.Validator=b;j.CE=g;j.CanvasLayer=i;j.Math=h;e.CE=j})(window);