var CanvasEngine={};CanvasEngine.AppObject=(function(){var a=function(){var b=this;b._changeCallbacks=[];b._bfrSet=[];b._changed=[];b._aftChange=[];b._acc=[]};a.validate=true;a.prototype.set=function(c){var b=this;if(c instanceof Object){Object.keys(b).forEach(function(e){if(c[e]!==undefined){var f=c[e];var d=b[e];if(!_.isEqual(d,f)){if(a.validate){if(b._bfrSet===undefined){b._bfrSet={}}if(b._bfrSet[e]!==undefined){f=b._bfrSet[e](d,f)}}if(!_.isEqual(d,f)){b[e]=f;if(b._changed===undefined){b._changed={}}b._changed[e]=true;if(b._changeCallbacks[e]!==undefined){b._changeCallbacks[e](f)}}}}});if(b._aftChange!==undefined&&b._aftChange.length>0&&Object.keys(b._changed).length>0){b._aftChange.forEach(function(d){d()})}b._changed=[]}return b};a.prototype._afterChange=function(c){var b=this;if(b._aftChange===undefined){b._aftChange=[]}b._aftChange.push(c)};a.prototype._isChanged=function(c){var b=this;return b._changed[c]!==undefined};a.prototype._beforeSet=function(c,d){var b=this;if(b[c]!==undefined||b[c]===null){if(b._bfrSet===undefined){b._bfrSet={}}b._bfrSet[c]=d}return b};a.prototype._onChange=function(c,d){var b=this;if(b[c]!==undefined||b[c]===null){if(b._changeCallbacks===undefined){b._changeCallbacks={}}b._changeCallbacks[c]=d}return b};a.prototype._unbindChange=function(c){var b=this;if(b._changeCallbacks!==undefined&&b._changeCallbacks[c]!==undefined){delete b._changeCallbacks[c]}};a.prototype.props=function(){return Object.keys(this)};a.prototype._accessible=function(c){var b=this;if(c!==undefined){b._acc={};c.forEach(function(d){if(b[d]!==undefined){b._acc[d]=true}})}else{if(b._acc===undefined){b._acc={}}return Object.keys(b._acc)}};a.prototype._props=function(){var c=this;var b=c._accessible();var d={};b.forEach(function(e){d[e]=c._propsR(c[e])});return d};a.prototype._propsR=function(c){var b=this;if(_.isArray(c)){c=c.map(function(d){return b._propsR(d)})}else{if(c instanceof a){c=c._props()}}return c};return a})();CanvasEngine.Validator=(function(){var a={regex:{PERCENT:/^[0-9]+(\.[0-9]+)?%$/,INT:/^[0-9]+$/,NUMBER:/^-?[0-9]+(\.[0-9]+)?$/,HEXADECIMAL_COLOR:/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?$/,RGB_COLOR:/^rgb\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\)$/,RGBA_COLOR:/^rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(0.[0-9]{1,2}|1)\)$/},validateInt:function(b,c){if(a.regex.INT.test(c)){return c}return b},validateNumber:function(b,c){if(_.isNumber(c)){return c}return b},validateObject:function(b,c){if(_.isObject(c)){return c}return b},validateColor:function(b,c){var d=a.regex;if(c==="transparent"||d.HEXADECIMAL_COLOR.test(c)||d.RGB_COLOR.test(c)||d.RGBA_COLOR.test(c)){return c}return b},validateString:function(b,c){if(_.isString(c)){return c}return b},validateArray:function(b,c){if(_.isArray(c)){return c}return b},validateBoolean:function(b,c){if(_.isBoolean(c)){return c}return b},validateFunction:function(b,c){if(_.isFunction(c)){return c}return b},validateElement:function(b,c){if(_.isElement(c)){return c}return b},isPercent:function(b){return this.regex.PERCENT.test(b)},isInt:function(b){return a.regex.INT.test(b)},isNumber:function(b){}};return a})();CanvasEngine.AbstractGrid=(function(){var a=CanvasEngine.AppObject,b=CanvasEngine.Validator;var c=function(e){console.log("initializing Abstract Grid...");var d=this;d.x=0;d.y=0;d.width=0;d.height=0;d.sw=0;d.sh=0;d.parent=null;d.fillStyle="transparent";d.strokeStyle="#000000";a.call(d);c.bindProperties.apply(d);d.set(e)};c.prototype=Object.create(a.prototype);c.prototype.constructor=c;c.bindProperties=function(){var d=this;d._beforeSet("width",b.validateNumber);d._beforeSet("height",b.validateNumber);d._beforeSet("sh",b.validateNumber);d._beforeSet("sw",b.validateNumber);d._beforeSet("fillStyle",b.validateColor);d._beforeSet("strokeStyle",b.validateColor)};c.prototype.isDrawable=function(){var d=this;return d.sw>0&&d.sh>0&&d.width>0&&d.height>0};return c})();CanvasEngine.IdGenerator=(function(){return{free:[],increment:0,getUniqueId:function(){var b=this;var d;var c=b.free.length;if(c>0){var a=Math.floor(Math.random()*c);d=b.free[a];b.free.splice(a,1)}else{d=++b.increment}return d},unlockId:function(b){var a=this;a.free.push(b)}}})();CanvasEngine.FrameSync=(function(){(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());return window.requestAnimationFrame})();CanvasEngine.Frame=(function(){var a=CanvasEngine.AppObject;var b=function(d){var c=this;c.imageSets=[];c.soundEffect=null;c.parent=null;b.bindProperties.apply(c);c.set(d)};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.bindProperties=function(){var c=this;c._accessible(["imageSets"])};b.prototype.add=function(d){var c=this;c.imageSets.push(d)};b.prototype.removeImageSet=function(e){var c=this;var d=c.imageSets.indexOf(e);if(d!==-1){c.imageSets.splice(d,1)}return c};return b})();CanvasEngine.Animation=(function(){var a=CanvasEngine.AppObject,d=CanvasEngine.FrameSync,c=CanvasEngine.Validator,b=CanvasEngine.Frame;var e=function(g){var f=this;f.speed=3;f.repeat=false;f.running=false;f.frames=[];f.indexFrame=-1;f.x=0;f.y=0;f.width=32;f.height=32;f.frameInterval=null;f.frameSync=null;f.canvasLayer=null;f.onStepCall=null;a.call(f);e.bindProperties.apply(f);f.set(g)};e.prototype=Object.create(a.prototype);e.prototype.constructor=e;e.bindProperties=function(){var f=this;f._beforeSet("speed",c.validateInt);f._beforeSet("repeat",c.validateBoolean);f._beforeSet("frames",c.validateArray);f._beforeSet("indexFrame",c.validateInt);f._beforeSet("x",c.validateNumber);f._beforeSet("y",c.validateNumber);f._beforeSet("y",c.validateNumber);f._beforeSet("width",c.validateNumber);f._beforeSet("height",c.validateNumber);f._accessible(["speed","repeat","frames","x","y","width","height"])};e.prototype.execute=function(){var f=this;if(!f.running){f.running=true;f.step()}};e.prototype.onStep=function(f){this.onStepCall=f};e.prototype.setSpeed=function(f){this.speed=f};e.prototype.getSpeed=function(){return this.speed};e.prototype.step=function(){var f=this;if(f.running){f.frameInterval=setTimeout(function(){f.frameSync=d(function(){f.step()});if(f.indexFrame>=f.frames.length-1){f.indexFrame=0}else{f.indexFrame=f.indexFrame+1}if(f.canvasLayer!==null){f.canvasLayer.drawAnimation(f)}if(f.onStepCall!==null){f.onStepCall(f.indexFrame)}},1000/(f.speed))}};e.prototype.pause=function(){var f=this;f.running=false;clearInterval(f.frameInterval);window.cancelAnimationFrame(f.frameSync);return f};e.prototype.add=function(g){var f=this;f.frames.push(g);return f};e.prototype.swap=function(i,h){var g=this;if(g.frames[i]!==undefined&&g.frames[h]!==undefined){var f=g.frames[i];g.frames[i]=g.frames[h];g.frames[h]=f}return g};e.prototype.remove=function(g){var f=this;if(g!==-1){f.frames.splice(g,1)}return f};e.prototype.clearFrames=function(){var f=this;f.frames=[];return f};e.prototype.stop=function(){var f=this;f.pause();f.indexFrame=-1;return f};e.prototype.getGraphic=function(){var f=this;if(f.indexFrame!=-1&&f.frames.length>0&&f.frames[f.indexFrame]!=undefined){return f.frames[f.indexFrame]}return null};e.prototype.isRunning=function(){return this.running};return e})();CanvasEngine.Math=(function(){var a={};a.dot=function(b,c){return Object.keys(b).reduce(function(d,e){return d+b[e]*c[e]},0)};a.vxv=function(b,d){var c={};Object.keys(b).forEach(function(e){c[e]=b[e]*d[e]});return c};a.vdv=function(b,d){var c={};Object.keys(b).forEach(function(e){c[e]=b[e]/d[e]});return c};a.vpv=function(b,d){var c={};Object.keys(b).forEach(function(e){c[e]=b[e]+d[e]});return c};a.vmv=function(b,d){var c={};Object.keys(b).forEach(function(e){c[e]=b[e]-d[e]});return c};a.sxv=function(e,b){var d={};Object.keys(b).forEach(function(c){d[c]=b[c]*e});return d};a.sdv=function(e,b){var d={};Object.keys(b).forEach(function(c){d[c]=b[c]/e});return d};a.mxv=function(c,b){return c.map(function(d){return a.dot(d,b)})};a.cross2=function(b,c){return b.x*c.y-b.y*c.x};a.norm=function(b){return a.sqrt(a.dot(b,b))};a.normalize=function(b){return a.sxv(1/a.norm(b),b)};a.med=function(d,c){var b={};Object.keys(d).forEach(function(e){b[e]=(d[e]+c[e])/2});return b};a.rotate=function(g,f,d){var c=a.degreeToRadians(f);d=d==undefined?{x:0,y:0}:d;var h=Math.cos(c);var e=Math.sin(c);var b=g.x-d.x;var i=g.y-d.y;return[(b*h-i*e)+d.x,(i*h+b*e)+d.y]};a.degreeToRadians=function(b){return b*(Math.PI/180)};a.degreeFromVec=function(c,b){var d=a.radiansFromVec(c,b);return a.radiansToDegree(d)};a.radiansFromVec=function(f,e){var d=a.dot(f,e);var c=a.norm(f);var b=a.norm(e);return Math.acos(d/(c*b))};a.radiansToDegree=function(b){return b*(180/Math.PI)};a.distance=function(c,b){return Math.sqrt(Object.keys(c).reduce(function(d,e){return d+Math.pow(c[e]-b[e],2)},0))};a.clockWiseDegreeFromVec=function(c){var b={x:0,y:-1};var d=a.degreeFromVec(c,b);if(c.x<0){d=360-d}return d};return a})();CanvasEngine.MouseReader=(function(){var a=CanvasEngine.AppObject,c=$,d=CanvasEngine.Validator;var b=function(f){var e=this;e.leftdown=[];e.rightdown=[];e.middledown=[];e.leftup=[];e.rightup=[];e.middleup=[];e.mousemove=[];e.element=null;e.initialize();a.call(e);b.bindProperties.apply(e);e.set(f)};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.bindProperties=function(){var e=this;e._beforeSet("element",function(f,g){g=d.validateElement(f,g);if(f!==g){$(f).unbind("mousemove");$(f).unbind("mousedown");$(f).unbind("mousewheel")}return g});e._onChange("element",function(g){e.initializeVars();$(g).mousemove(function(j){j.preventDefault();var k=j.target;var i=j.offsetX;var l=j.offsetY;e.lastMove={x:i,y:l};e.mousemove.forEach(function(m){m.apply(e,[j])})});$(g).mousedown(function(i){i.preventDefault();var j={x:i.offsetX,y:i.offsetY};switch(i.which){case 1:e.left=true;e.lastDown.left=j;e.leftdown.forEach(function(k){k.apply(e,[i])});break;case 2:e.middle=true;e.lastDown.middle=j;e.middledown.forEach(function(k){k.apply(e,[i])});break;case 3:e.right=true;e.lastDown.right=j;e.rightdown.forEach(function(k){k.apply(e,[i])})}});$(g).mouseout(function(i){e.left=false;e.right=false;e.middle=false});var h=function(i){i.preventDefault();e.lastWheel=i.detail?i.detail*(-120):i.wheelDelta;e.mouseWheel.forEach(function(j){j.apply(e,[i])})};var f=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";if($(g)[0].attachEvent){$(g)[0].attachEvent("on"+f,h)}else{if($(e.element)[0].addEventListener){$(g)[0].addEventListener(f,h,false)}}})};b.prototype.initializeVars=function(){var e=this;e.left=false;e.middle=false;e.right=false;e.lastDown={left:{x:0,y:0},right:{x:0,y:0},middle:{x:0,y:0}};e.lastUp={left:{x:0,y:0},right:{x:0,y:0},middle:{x:0,y:0}};e.lastMove={x:0,y:0};e.lastWheel=0;e.mouseWheel=[]};b.prototype.initialize=function(){var e=this;e.initializeVars();$(document).mouseup(function(f){f.preventDefault();if(e.element!==null){var g={x:f.offsetX,y:f.offsetY};switch(f.which){case 1:e.left=false;e.lastUp.left=g;e.leftup.forEach(function(h){h.apply(e,[f])});break;case 2:e.middle=false;e.lastUp.middle=g;e.middleup.forEach(function(h){h.apply(e,[f])});break;case 3:e.right=false;e.lastUp.right=g;e.rightup.forEach(function(h){h.apply(e,[f])})}}})};b.prototype.onmousewheel=function(f){var e=this;e.mouseWheel.push(f)};b.prototype.onmousedown=function(f,g){var e=this;switch(f){case 1:e.leftdown.push(g);break;case 2:e.middledown.push(g);break;case 3:e.rightdown.push(g)}};b.prototype.onmouseup=function(f,g){var e=this;switch(f){case 1:e.leftup.push(g);break;case 2:e.middleup.push(g);break;case 3:e.rightup.push(g)}};b.prototype.onmousemove=function(f){var e=this;e.mousemove.push(f)};b.LEFT=1;b.MIDDLE=2;b.RIGHT=3;return b})();CanvasEngine.Color=(function(){var a=CanvasEngine.AppObject;var b=function(d){var c=this;c.red=0;c.blue=0;c.green=0;c.alpha=1;a.call(c);c.set(d)};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.isTransparent=function(){return this.alpha===0};b.random=function(d){d=d==undefined?false:d;var c=new b({red:Math.floor(Math.random()*255),blue:Math.floor(Math.random()*255),green:Math.floor(Math.random()*255),opacity:Math.random()});if(d){return c.toRGBA()}return c.toHEX()};b.prototype.toRGB=function(){var c=this;if(c.isTransparent()){return"transparent"}return"rgb("+c.red+","+c.blue+","+c.green+")"};b.prototype.toRGBA=function(){var c=this;if(c.isTransparent()){return"transparent"}return"rgba("+c.red+","+c.blue+","+c.green+","+c.alpha+")"};b.prototype.toHEX=function(){var d=this;if(d.isTransparent()){return"transparent"}var f=d.red.toString(16);var e=d.blue.toString(16);var c=d.green.toString(16);f=f.length<2?f+"0":f;e=e.length<2?e+"0":e;c=c.length<2?c+"0":c;return("#"+f+e+c).toUpperCase()};b.prototype.toString=function(){var c=this;if(c.isTransparent()){return"transparent"}return c.toRGBA()};b.prototype.reverse=function(){var c=this;c.red=c.red<128?128+(128-c.red):128-(c.red-128);c.blue=c.blue<128?128+(128-c.blue):128-(c.blue-128);c.green=c.green<128?128+(128-c.green):128-(c.green-128);return c};b.asName=function(){var c=this;if(c.isTransparent()){return"transparent"}for(var d in b.Name){if(b.Name[d]===c.toHEX()){return d}}return c.toHEX()};b.Name={Snow:"#FFFAFA",GhostWhite:"#F8F8FF",WhiteSmoke:"#F5F5F5",Gainsboro:"#DCDCDC",FloralWhite:"#FFFAF0",OldLace:"#FDF5E6",Linen:"#FAF0E6",AntiqueWhite:"#FAEBD7",PapayaWhip:"#FFEFD5",BlanchedAlmond:"#FFEBCD",Bisque:"#FFE4C4",PeachPuff:"#FFDAB9",NavajoWhite:"#FFDEAD",Moccasin:"#FFE4B5",Cornsilk:"#FFF8DC",Ivory:"#FFFFF0",LemonChiffon:"#FFFACD",Seashell:"#FFF5EE",Honeydew:"#F0FFF0",MintCream:"#F5FFFA",Azure:"#F0FFFF",AliceBlue:"#F0F8FF",lavender:"#E6E6FA",LavenderBlush:"#FFF0F5",MistyRose:"#FFE4E1",White:"#FFFFFF",Black:"#000000",DarkSlateGray:"#2F4F4F",DimGrey:"#696969",SlateGrey:"#708090",LightSlateGray:"#778899",Grey:"#BEBEBE",LightGray:"#D3D3D3",MidnightBlue:"#191970",NavyBlue:"#000080",CornflowerBlue:"#6495ED",DarkSlateBlue:"#483D8B",SlateBlue:"#6A5ACD",MediumSlateBlue:"#7B68EE",LightSlateBlue:"#8470FF",MediumBlue:"#0000CD",RoyalBlue:"#4169E1",Blue:"#0000FF",DodgerBlue:"#1E90FF",DeepSkyBlue:"#00BFFF",SkyBlue:"#87CEEB",LightSkyBlue:"#87CEFA",SteelBlue:"#4682B4",LightSteelBlue:"#B0C4DE",LightBlue:"#ADD8E6",PowderBlue:"#B0E0E6",PaleTurquoise:"#AFEEEE",DarkTurquoise:"#00CED1",MediumTurquoise:"#48D1CC",Turquoise:"#40E0D0",Cyan:"#00FFFF",LightCyan:"#E0FFFF",CadetBlue:"#5F9EA0",MediumAquamarine:"#66CDAA",Aquamarine:"#7FFFD4",DarkGreen:"#006400",DarkOliveGreen:"#556B2F",DarkSeaGreen:"#8FBC8F",SeaGreen:"#2E8B57",MediumSeaGreen:"#3CB371",LightSeaGreen:"#20B2AA",PaleGreen:"#98FB98",SpringGreen:"#00FF7F",LawnGreen:"#7CFC00",Green:"#00FF00",Chartreuse:"#7FFF00",MedSpringGreen:"#00FA9A",GreenYellow:"#ADFF2F",LimeGreen:"#32CD32",YellowGreen:"#9ACD32",ForestGreen:"#228B22",OliveDrab:"#6B8E23",DarkKhaki:"#BDB76B",PaleGoldenrod:"#EEE8AA",LtGoldenrodYello:"#FAFAD2",LightYellow:"#FFFFE0",Yellow:"#FFFF00",Gold:"#FFD700",LightGoldenrod:"#EEDD82",goldenrod:"#DAA520",DarkGoldenrod:"#B8860B",RosyBrown:"#BC8F8F",IndianRed:"#CD5C5C",SaddleBrown:"#8B4513",Sienna:"#A0522D",Peru:"#CD853F",Burlywood:"#DEB887",Beige:"#F5F5DC",Wheat:"#F5DEB3",SandyBrown:"#F4A460",Tan:"#D2B48C",Chocolate:"#D2691E",Firebrick:"#B22222",Brown:"#A52A2A",DarkSalmon:"#E9967A",Salmon:"#FA8072",LightSalmon:"#FFA07A",Orange:"#FFA500",DarkOrange:"#FF8C00",Coral:"#FF7F50",LightCoral:"#F08080",Tomato:"#FF6347",OrangeRed:"#FF4500",Red:"#FF0000",HotPink:"#FF69B4",DeepPink:"#FF1493",Pink:"#FFC0CB",LightPink:"#FFB6C1",PaleVioletRed:"#DB7093",Maroon:"#B03060",MediumVioletRed:"#C71585",VioletRed:"#D02090",Magenta:"#FF00FF",Violet:"#EE82EE",Plum:"#DDA0DD",Orchid:"#DA70D6",MediumOrchid:"#BA55D3",DarkOrchid:"#9932CC",DarkViolet:"#9400D3",BlueViolet:"#8A2BE2",Purple:"#A020F0",MediumPurple:"#9370DB",Thistle:"#D8BFD8",Snow1:"#FFFAFA",Snow2:"#EEE9E9",Snow3:"#CDC9C9",Snow4:"#8B8989",Seashell1:"#FFF5EE",Seashell2:"#EEE5DE",Seashell3:"#CDC5BF",Seashell4:"#8B8682",AntiqueWhite1:"#FFEFDB",AntiqueWhite2:"#EEDFCC",AntiqueWhite3:"#CDC0B0",AntiqueWhite4:"#8B8378",Bisque1:"#FFE4C4",Bisque2:"#EED5B7",Bisque3:"#CDB79E",Bisque4:"#8B7D6B",PeachPuff1:"#FFDAB9",PeachPuff2:"#EECBAD",PeachPuff3:"#CDAF95",PeachPuff4:"#8B7765",NavajoWhite1:"#FFDEAD",NavajoWhite2:"#EECFA1",NavajoWhite3:"#CDB38B",NavajoWhite4:"#8B795E",LemonChiffon1:"#FFFACD",LemonChiffon2:"#EEE9BF",LemonChiffon3:"#CDC9A5",LemonChiffon4:"#8B8970",Cornsilk1:"#FFF8DC",Cornsilk2:"#EEE8CD",Cornsilk3:"#CDC8B1",Cornsilk4:"#8B8878",Ivory1:"#FFFFF0",Ivory2:"#EEEEE0",Ivory3:"#CDCDC1",Ivory4:"#8B8B83",Honeydew1:"#F0FFF0",Honeydew2:"#E0EEE0",Honeydew3:"#C1CDC1",Honeydew4:"#838B83",LavenderBlush1:"#FFF0F5",LavenderBlush2:"#EEE0E5",LavenderBlush3:"#CDC1C5",LavenderBlush4:"#8B8386",SlateGray4:"#6C7B8B",LightSteelBlue1:"#CAE1FF",LightSteelBlue2:"#BCD2EE",LightSteelBlue3:"#A2B5CD",LightSteelBlue4:"#6E7B8B",LightBlue1:"#BFEFFF",LightBlue2:"#B2DFEE",LightBlue3:"#9AC0CD",LightBlue4:"#68838B",LightCyan1:"#E0FFFF",LightCyan2:"#D1EEEE",LightCyan3:"#B4CDCD",LightCyan4:"#7A8B8B",PaleTurquoise1:"#BBFFFF",PaleTurquoise2:"#AEEEEE",PaleTurquoise3:"#96CDCD",PaleTurquoise4:"#668B8B",CadetBlue1:"#98F5FF",CadetBlue2:"#8EE5EE",CadetBlue3:"#7AC5CD",CadetBlue4:"#53868B",Turquoise1:"#00F5FF",Turquoise2:"#00E5EE",Turquoise3:"#00C5CD",Turquoise4:"#00868B",Cyan1:"#00FFFF",Cyan2:"#00EEEE",Cyan3:"#00CDCD",Cyan4:"#008B8B",DarkSlateGray1:"#97FFFF",DarkSlateGray2:"#8DEEEE",DarkSlateGray3:"#79CDCD",DarkSlateGray4:"#528B8B",Aquamarine1:"#7FFFD4",Aquamarine2:"#76EEC6",Aquamarine3:"#66CDAA",Aquamarine4:"#458B74",DarkSeaGreen1:"#C1FFC1",DarkSeaGreen2:"#B4EEB4",DarkSeaGreen3:"#9BCD9B",DarkSeaGreen4:"#698B69",SeaGreen1:"#54FF9F",SeaGreen2:"#4EEE94",MistyRose1:"#FFE4E1",MistyRose2:"#EED5D2",MistyRose3:"#CDB7B5",MistyRose4:"#8B7D7B",Azure1:"#F0FFFF",Azure2:"#E0EEEE",Azure3:"#C1CDCD",Azure4:"#838B8B",SlateBlue1:"#836FFF",SlateBlue2:"#7A67EE",SlateBlue3:"#6959CD",SlateBlue4:"#473C8B",RoyalBlue1:"#4876FF",RoyalBlue2:"#436EEE",RoyalBlue3:"#3A5FCD",RoyalBlue4:"#27408B",Blue1:"#0000FF",Blue2:"#0000EE",Blue3:"#0000CD",Blue4:"#00008B",DodgerBlue1:"#1E90FF",DodgerBlue2:"#1C86EE",DodgerBlue3:"#1874CD",DodgerBlue4:"#104E8B",SteelBlue1:"#63B8FF",SteelBlue2:"#5CACEE",SteelBlue3:"#4F94CD",SteelBlue4:"#36648B",DeepSkyBlue1:"#00BFFF",DeepSkyBlue2:"#00B2EE",DeepSkyBlue3:"#009ACD",DeepSkyBlue4:"#00688B",SkyBlue1:"#87CEFF",SkyBlue2:"#7EC0EE",SkyBlue3:"#6CA6CD",SkyBlue4:"#4A708B",LightSkyBlue1:"#B0E2FF",LightSkyBlue2:"#A4D3EE",LightSkyBlue3:"#8DB6CD",LightSkyBlue4:"#607B8B",SlateGray1:"#C6E2FF",SlateGray2:"#B9D3EE",SlateGray3:"#9FB6CD",Firebrick4:"#8B1A1A",Brown1:"#FF4040",Brown2:"#EE3B3B",Brown3:"#CD3333",Brown4:"#8B2323",Salmon1:"#FF8C69",Salmon2:"#EE8262",Salmon3:"#CD7054",Salmon4:"#8B4C39",LightSalmon1:"#FFA07A",LightSalmon2:"#EE9572",LightSalmon3:"#CD8162",LightSalmon4:"#8B5742",Orange1:"#FFA500",Orange2:"#EE9A00",Orange3:"#CD8500",Orange4:"#8B5A00",DarkOrange1:"#FF7F00",DarkOrange2:"#EE7600",DarkOrange3:"#CD6600",DarkOrange4:"#8B4500",Coral1:"#FF7256",Coral2:"#EE6A50",Coral3:"#CD5B45",Coral4:"#8B3E2F",Tomato1:"#FF6347",Tomato2:"#EE5C42",Tomato3:"#CD4F39",Tomato4:"#8B3626",OrangeRed1:"#FF4500",OrangeRed2:"#EE4000",OrangeRed3:"#CD3700",OrangeRed4:"#8B2500",Red1:"#FF0000",Red2:"#EE0000",Red3:"#CD0000",Red4:"#8B0000",DeepPink1:"#FF1493",DeepPink2:"#EE1289",DeepPink3:"#CD1076",DeepPink4:"#8B0A50",HotPink1:"#FF6EB4",HotPink2:"#EE6AA7",Gold2:"#EEC900",HotPink3:"#CD6090",HotPink4:"#8B3A62",Pink1:"#FFB5C5",Pink2:"#EEA9B8",Pink3:"#CD919E",Pink4:"#8B636C",LightPink1:"#FFAEB9",LightPink2:"#EEA2AD",LightPink3:"#CD8C95",LightPink4:"#8B5F65",PaleVioletRed1:"#FF82AB",PaleVioletRed2:"#EE799F",PaleVioletRed3:"#CD6889",PaleVioletRed4:"#8B475D",Maroon1:"#FF34B3",Maroon2:"#EE30A7",Maroon3:"#CD2990",Maroon4:"#8B1C62",VioletRed1:"#FF3E96",VioletRed2:"#EE3A8C",VioletRed3:"#CD3278",VioletRed4:"#8B2252",Magenta1:"#FF00FF",Magenta2:"#EE00EE",Magenta3:"#CD00CD",Magenta4:"#8B008B",Orchid1:"#FF83FA",Orchid2:"#EE7AE9",Orchid3:"#CD69C9",Orchid4:"#8B4789",Plum1:"#FFBBFF",Plum2:"#EEAEEE",Plum3:"#CD96CD",Plum4:"#8B668B",MediumOrchid1:"#E066FF",MediumOrchid2:"#D15FEE",MediumOrchid3:"#B452CD",MediumOrchid4:"#7A378B",DarkOrchid1:"#BF3EFF",DarkOrchid2:"#B23AEE",DarkOrchid3:"#9A32CD",DarkOrchid4:"#68228B",Purple1:"#9B30FF",Purple2:"#912CEE",SeaGreen3:"#43CD80",SeaGreen4:"#2E8B57",PaleGreen1:"#9AFF9A",PaleGreen2:"#90EE90",PaleGreen3:"#7CCD7C",PaleGreen4:"#548B54",SpringGreen1:"#00FF7F",SpringGreen2:"#00EE76",SpringGreen3:"#00CD66",SpringGreen4:"#008B45",Green1:"#00FF00",Green2:"#00EE00",Green3:"#00CD00",Green4:"#008B00",Chartreuse1:"#7FFF00",Chartreuse2:"#76EE00",Chartreuse3:"#66CD00",Chartreuse4:"#458B00",OliveDrab1:"#C0FF3E",OliveDrab2:"#B3EE3A",OliveDrab3:"#9ACD32",OliveDrab4:"#698B22",DarkOliveGreen1:"#CAFF70",DarkOliveGreen2:"#BCEE68",DarkOliveGreen3:"#A2CD5A",DarkOliveGreen4:"#6E8B3D",Khaki1:"#FFF68F",Khaki2:"#EEE685",Khaki3:"#CDC673",Khaki4:"#8B864E",LightGoldenrod1:"#FFEC8B",LightGoldenrod2:"#EEDC82",LightGoldenrod3:"#CDBE70",LightGoldenrod4:"#8B814C",LightYellow1:"#FFFFE0",LightYellow2:"#EEEED1",LightYellow3:"#CDCDB4",LightYellow4:"#8B8B7A",Yellow1:"#FFFF00",Yellow2:"#EEEE00",Yellow3:"#CDCD00",Yellow4:"#8B8B00",Gold1:"#FFD700",Gold3:"#CDAD00",Gold4:"#8B7500",Goldenrod1:"#FFC125",Goldenrod2:"#EEB422",Goldenrod3:"#CD9B1D",Goldenrod4:"#8B6914",DarkGoldenrod1:"#FFB90F",DarkGoldenrod2:"#EEAD0E",DarkGoldenrod3:"#CD950C",DarkGoldenrod4:"#8B658B",RosyBrown1:"#FFC1C1",RosyBrown2:"#EEB4B4",RosyBrown3:"#CD9B9B",RosyBrown4:"#8B6969",IndianRed1:"#FF6A6A",IndianRed2:"#EE6363",IndianRed3:"#CD5555",IndianRed4:"#8B3A3A",Sienna1:"#FF8247",Sienna2:"#EE7942",Sienna3:"#CD6839",Sienna4:"#8B4726",Burlywood1:"#FFD39B",Burlywood2:"#EEC591",Burlywood3:"#CDAA7D",Burlywood4:"#8B7355",Wheat1:"#FFE7BA",Wheat2:"#EED8AE",Wheat3:"#CDBA96",Wheat4:"#8B7E66",Tan1:"#FFA54F",Purple3:"#7D26CD",Purple4:"#551A8B",MediumPurple1:"#AB82FF",MediumPurple2:"#9F79EE",MediumPurple3:"#8968CD",MediumPurple4:"#5D478B",Thistle1:"#FFE1FF",Thistle2:"#EED2EE",Thistle3:"#CDB5CD",Thistle4:"#8B7B8B",grey11:"#1C1C1C",grey21:"#363636",grey31:"#4F4F4F",grey41:"#696969",grey51:"#828282",grey61:"#9C9C9C",grey71:"#B5B5B5",gray81:"#CFCFCF",gray91:"#E8E8E8",DarkGrey:"#A9A9A9",DarkBlue:"#00008B",DarkCyan:"#008B8B",DarkMagenta:"#8B008B",DarkRed:"#8B0000",LightGreen:"#90EE90",Chocolate3:"#CD661D",Chocolate4:"#8B4513",Firebrick1:"#FF3030",Firebrick2:"#EE2C2C",Firebrick3:"#CD2626",Tan2:"#EE9A49",Tan3:"#CD853F",Tan4:"#8B5A2B",Chocolate1:"#FF7F24",Chocolate2:"#EE7621"};b.Patterns={HEXADECIMAL:/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?$/,RGB:/^rgb\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\)$/,RGBA:/^rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(0.[0-9]{1,2}|1)\)$/,NAME:/^[A-Z][a-zA-z0-9]{2,15}$/};b.isColor=function(c){c=b.parse(c);return c!==null};b.parse=function(i){var e=null;if(typeof i==="string"){var h;var f;var c;if(i==="transparent"){e=new b({alpha:0})}else{if(b.Patterns.HEXADECIMAL.test(i)){i=i.substr(i.indexOf("#")+1,i.length);h=parseInt(i.substr(0,2),16);f=parseInt(i.substr(2,2),16);c=parseInt(i.substr(4,2),16);e=new b({red:h,blue:f,green:f})}else{if(b.Patterns.RGB.test(i)){i=i.replace("rgb(","").replace(")","").split(",");h=parseInt(i[0]);f=parseInt(i[1]);c=parseInt(i[2]);e=new b({red:h,blue:c,green:f})}else{if(b.Patterns.RGBA.test(i)){i=i.replace("rgba(","").replace(")","").split(",");h=parseInt(i[0]);f=parseInt(i[1]);c=parseInt(i[2]);var d=parseFloat(i[3]);e=new b({red:h,blue:c,green:f,alpha:d})}else{if(b.Patterns.NAME.test(i)){e=b.parse(b.Name[i])}}}}}}return e};return b})();CanvasEngine.CanvasLayer=(function(){var c=$,a=CanvasEngine.AppObject,e=CanvasEngine.Color,d=CanvasEngine.Validator;var b=function(h,g){console.log("Canvas Layer initialize...");var f=this;f.context=null;f.element=null;f.canvas=g;f.zIndex=0;f.width=300;f.height=300;f.left=0;f.top=0;f.savedStates=[];f.name="";f.mouseReader=null;f.element=null;f.opacity=1;f.visible=true;f.backgroundColor="transparent";f.transparentRegex=/^\s*transparent\s*|rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*0\s*\)\s*$/;f.defaultValues={rect:{x:0,y:0,width:10,height:10,backgroundColor:"transparent",borderColor:"black",opacity:100,origin:{x:0,y:0}},circle:{x:0,y:0,radius:10,backgroundColor:"transparent",borderColor:"black",opacity:100,origin:{x:0,y:0}},polygon:{backgroundColor:"transparent",borderColor:"black",origin:{x:0,y:0},opacity:100,points:[]},image:{image:null,sx:0,sy:0,sWidth:"auto",sHeight:"auto",dx:0,dy:0,dWidth:"auto",dHeight:"auto"}};a.call(f);b.bindProperties.apply(f);f.set(h)};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.bindProperties=function(){var f=this;f._onChange("zIndex",function(g){$(f.getElement()).css({zIndex:g})});f._onChange("opacity",function(g){$(f.getElement()).css({opacity:g})});f._onChange("visible",function(g){if(g){f.show()}else{f.hide()}});f._onChange("width",function(g){$(f.getElement()).prop("width",g)});f._onChange("height",function(g){$(f.getElement()).prop("height",g)});f._onChange("name",function(g){if(g.length===0){$(f.getElement()).removeAttr("data-name")}else{$(f.getElement()).attr("data-name",g)}});f._onChange("left",function(g){$(f.getElement()).css({left:g})});f._onChange("top",function(g){$(f.getElement()).css({top:g})});f._onChange("backgroundColor",function(g){$(f.getElement()).css({backgroundColor:g})});f._beforeSet("_aftResize",d.validateFunction);f._beforeSet("opacity",d.validateNumber);f._beforeSet("width",d.validateNumber);f._beforeSet("height",d.validateNumber);f._beforeSet("zIndex",d.validateInt);f._beforeSet("left",d.validateNumber);f._beforeSet("top",d.validateNumber);f._beforeSet("backgroundColor",d.validateColor);f._beforeSet("visible",d.validateBoolean)};b.prototype.getVisibleArea=function(){var h=this;var i=Math.min(h.width,h.canvas.getWidth());var g=Math.min(h.height,h.canvas.getHeight());var f=Math.abs(h.canvas.viewX);var j=Math.abs(h.canvas.viewY);return{x:f,y:j,width:i,height:g}};b.prototype.isSetVisible=function(g){var f=this;var h=f.getVisibleArea();return !(g.x+g.width<h.x||h.x+h.width<g.x||g.y+g.height<h.y||h.y+h.height<g.y)};b.prototype.show=function(){var f=this;$(f.getElement()).css({visibility:"visible"});return f};b.prototype.hide=function(){var f=this;$(f.getElement()).css({visibility:"hidden"});return f};b.prototype.saveState=function(i){var g=this;var h=g.getElement().toDataURL("image/png");var f=document.createElement("img");f.src=h;g.savedStates[i]=f;return g};b.prototype.restoreState=function(g){var f=this;var h=f.savedStates[g];if(h!==undefined){f.getContext().drawImage(h,0,0)}return f};b.prototype.clearStates=function(){var f=this;f.savedStates=[];return f};b.prototype.getElement=function(){var f=this;if(f.element===null){f.element=document.createElement("canvas");$(f.element).css({pointerEvents:"none",userSelect:"none",position:"absolute",left:f.left,top:f.top,backgroundColor:f.backgroundColor,opacity:f.opacity})}return f.element};b.prototype.getContext=function(){var f=this;if(f.context===null){f.context=f.getElement().getContext("2d");if(f.context.setLineDash===undefined){f.context.setLineDash=function(){}}}return f.context};b.prototype.destroy=function(){var f=this;$(f.element).remove();if(f.canvas.layers[f.zIndex]!==undefined){delete f.canvas.layers[f.zIndex]}};b.prototype.drawImage=function(){var f=this;var g=f.getContext();g.drawImage.apply(g,arguments);return f};b.prototype.drawImageSet=function(h){var f=this;var g=f.getContext();h.parent=f;g.drawImage(h.image,h.sx,h.sy,h.sWidth,h.sHeight,h.x,h.y,h.width,h.height);if(h.selected){g.strokeStyle="rgba(0,0,100,0.5)";g.setLineDash([5,5]);g.strokeRect(h.x,h.y,h.width,h.height)}return f};b.prototype.clear=function(){var f=this;f.getContext().clearRect(0,0,f.width,f.height);return f};b.prototype.drawAnimation=function(g){var f=this;f.clearRect({x:g.x,y:g.y,width:g.width,height:g.height});if(g.frames[g.indexFrame]!==undefined){var h=g.frames[g.indexFrame];f.image(h)}return f};b.prototype.getPixel=function(k,g){var f=this;var h=f.getContext();var l=h.getImageData(k,g,1,1).data;return new e({red:l[0],green:l[1],blue:l[2],alpha:l[3]})};b.prototype.afterResize=function(g){var f=this;f.set({_aftResize:g})};b.prototype.image=function(r){var p=this;r=r==undefined?p.defaultValues.image:_.merge(p.defaultValues.image,r);var g=r.image;if(g!=null&&g instanceof HTMLImageElement){var k=r.dWidth;var h=r.dHeight;var f=r.sWidth;var i=r.sHeight;var m=r.sx;var l=r.sy;var q=r.dx;var n=r.dy;var j;if(k=="auto"&&h=="auto"){k=g.width;h=g.height}else{if(k=="auto"&&_.isNumber(h)){k=g.width*(h/g.height)}else{if(h=="auto"&&_.isNumber(k)){h=g.height*(k/g.width)}}}if(_.isNumber(r.sWidth)&&r.sWidth>0){f=r.sWidth}else{if(d.isPercent(r.sWidth)){j=parseFloat(r.sWidth.replace("%",""));f=g.width*(j/100)}else{f=g.width}}if(_.isNumber(r.sHeight)&&r.sHeight>0){i=r.sHeight}else{if(d.isPercent(r.sHeight)){j=parseFloat(r.sHeight.replace("%",""));i=g.height*(j/100)}else{i=g.height}}if(d.isPercent(r.dWidth)){j=parseFloat(r.dWidth.replace("%",""));k=f*(j/100)}else{if(_.isNumber(r.dWidth)&&r.dWidth>0){k=r.dWidth}}if(d.isPercent(r.dHeight)){j=parseFloat(r.dHeight.replace("%",""));h=i*(j/100)}else{if(_.isNumber(r.dHeight)&&r.dHeight>0){h=r.dHeight}}if(d.isPercent(m)){j=parseFloat(m.replace("%",""));m=g.width*(j/100)}if(d.isPercent(l)){j=parseFloat(l.replace("%",""));l=g.height*(j/100)}if(k>0&&h>0){this.getContext().drawImage(g,m,l,f,i,q,n,k,h)}}};b.prototype.circle=function(g){var f=this;g=g==undefined?f.defaultValues.circle:_.merge(f.defaultValues.circle,g);var h=f.getContext();h.save();f.setContext(g);h.beginPath();h.arc(g.x,g.y,g.radius,0,2*Math.PI);if(h.fillStyle!=null&&!f.transparentRegex.test(h.fillStyle)){h.fill()}if(h.strokeStyle!=null&&!f.transparentRegex.test(h.strokeStyle)){h.stroke()}h.restore();return f};b.prototype.rect=function(g){var f=this;g=g==undefined?f.defaultValues.rect:_.merge(f.defaultValues.rect,g);var h=f.getContext();h.save();f.setContext(g);if(h.fillStyle!=null&&!f.transparentRegex.test(h.fillStyle)){h.fillRect(g.x,g.y,g.width,g.height)}if(h.strokeStyle!=null&&!f.transparentRegex.test(h.strokeStyle)){h.strokeRect(g.x,g.y,g.width,g.height)}h.restore();return f};b.prototype.clearRect=function(g){var f=this;g=g==undefined?f.defaultValues.rect:_.merge(f.defaultValues.rect,g);var h=f.getContext();h.clearRect(g.x,g.y,g.width,g.height)};b.prototype.clearCircle=function(g){var f=this;g=g==undefined?f.defaultValues.circle:_.merge(f.defaultValues.circle,g);var h=f.getContext();h.save();h.arc(g.x,g.y,g.radius,0,Math.PI);h.clip();h.clearRect(g.x-g.radius,g.y-g.radius,g.radius*2,g.radius*2);h.restore()};b.prototype.polygon=function(g){var f=this;g=g==undefined?f.defaultValues.polygon:_.merge(f.defaultValues.polygon,g);var k=g.points.length;var j=f.getContext();j.save();f.setContext(g);if(k>0){j.beginPath();var l=g.points[0];j.moveTo(l[0],l[1]);for(var h=1;h<k;h++){l=g.points[h];j.lineTo(l[0],l[1])}j.closePath();if(j.fillStyle!=null&&!f.transparentRegex.test(j.fillStyle)){j.fill()}if(j.strokeStyle!=null&&!f.transparentRegex.test(j.strokeStyle)){j.stroke()}}j.restore()};b.prototype.setContext=function(i){var h=this;var j=h.getContext();if(i.backgroundColor!=undefined){j.fillStyle=i.backgroundColor}if(i.borderColor!=undefined){j.strokeStyle=i.borderColor}if(i.opacity!=undefined){j.globalAlpha=i.opacity/100}if(i.origin!=undefined){var g=0;var f=0;if(_.isString(i.origin)){switch(i.origin){case"center":g=i.x+(i.width/2);f=i.y+(i.height/2);break}}else{if(_.isObject(i.origin)){g=i.origin.x;f=i.origin.y}}j.translate(g,f);i.x=i.x-g;i.y=i.y-f}if(i.rotate!=undefined){var k=i.rotate*(Math.PI/180);j.rotate(k)}};return b})();CanvasEngine.GridLayer=(function(){var a=CanvasEngine.CanvasLayer,c=CanvasEngine.Color;var b=function(f,e){var d=this;a.call(d,f,e)};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.drawGrid=function(f){var d=this;var e=d.getContext();f.rectSets.forEach(function(g){g.forEach(function(h){e.fillStyle=h.fillStyle;e.strokeStyle=h.strokeStyle;e.setLineDash(h.lineDash);e.lineWidth=h.lineWidth;e.fillRect(h.x,h.y,h.width,h.height);e.strokeRect(h.x,h.y,h.width,h.height)})});f.parent=this;return d};b.prototype.drawAbstractGrid=function(d){var p=this;if(d.isDrawable()){var g=p.getContext();g.fillStyle="transparent";g.strokeStyle=(new c({alpha:0.2})).toRGBA();g.lineWidth=1;g.lineDash=[];var h=p.getVisibleArea();var f=h.x!==0?Math.floor(h.x/d.sw):0;var e=h.y!==0?Math.floor(h.y/d.sh):0;var n=Math.ceil((h.x+h.width)/d.sw);var m=Math.ceil((h.y+h.height)/d.sh);for(var l=f;l<n;l++){for(var k=e;k<m;k++){g.strokeRect((l*d.sw)+d.x,(k*d.sh)+d.y,d.sw,d.sh)}}}return p};b.prototype.drawRectSet=function(e){var d=this;var f=d.getContext();f.fillStyle=e.fillStyle;f.strokeStyle=e.strokeStyle;f.fillRect(e.x,e.y,e.width,e.height);f.strokeRect(e.x,e.y,e.width,e.height);return d};return b})();CanvasEngine.KeyReader=(function(){var a=$;var b=function(d){var c=this;c.element=d;c.deny=false;c.keySequence=[];c.allowedSequences=[];c.lastKeyDown=null;c.lastKeyUp=null;c.onSequenceCallbacks=[];c.initialize()};b.prototype.key=function(c){if(b.Keys[c]!==undefined){return b.Keys[c]}return null};b.prototype.onSequence=function(e,d){var c=this;c.onSequenceCallbacks.push({sequence:e,callback:d})};b.prototype.sequenceIs=function(g,c,e){var d=this;c=c===undefined?false:c;e=e===undefined?false:e;if(e&&g.length!==d.keySequence.length){return false}for(var f=0;f<g.length;f++){if(c){if(g[f]!==d.keySequence[f]){return false}}else{if(d.keySequence.indexOf(g[f])===-1){return false}}}return true};b.prototype.denyAll=function(){this.deny=true};b.prototype.allowAll=function(){this.deny=false};b.prototype.allow=function(){var c=this;var e=arguments.length;for(var d=0;d<e;d++){var f=arguments[d];if(!(f instanceof Array)){f=[f]}c.allowedSequences.push(f)}};b.prototype.initialize=function(){var c=this;$(document).ready(function(){console.log("key reader initialize...");$(c.element).attr("tabindex",1);$(c.element).click(function(){$(this).focus()});$(c.element).keydown(function(g){if(c.keySequence.indexOf(g.which)===-1){c.keySequence.push(g.which)}if(c.deny){var f=c.allowedSequences.length;var h=false;for(var d=0;d<f;d++){var j=c.allowedSequences[d];if(c.sequenceIs(j,false,true)){h=true}}if(!h){g.preventDefault()}}c.onSequenceCallbacks.forEach(function(e){if(c.sequenceIs(e.sequence)){e.callback()}})});$(c.element).keyup(function(f){var d=c.keySequence.indexOf(f.which);if(d!==-1){c.keySequence.splice(d,1)}})})};b.Keys={KEY_DOWN:40,KEY_UP:38,KEY_LEFT:37,KEY_RIGHT:39,KEY_END:35,KEY_BEGIN:36,KEY_BACK_TAB:8,KEY_TAB:9,KEY_SH_TAB:16,KEY_ENTER:13,KEY_ESC:27,KEY_SPACE:32,KEY_DEL:46,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_PLUS:107,KEY_MINUS:109,KEY_PF1:112,KEY_PF2:113,KEY_PF3:114,KEY_PF4:115,KEY_PF5:116,KEY_PF6:117,KEY_PF7:118,KEY_PF8:119,KEY_CTRL:17,KEY_ALT_GR:18,KEY_SBL:221,KEY_SBR:220};return b})();CanvasEngine.RectSet=(function(){var b=CanvasEngine.AppObject,d=CanvasEngine.Color,c=CanvasEngine.Validator;var a=function(f){var e=this;e.width=32;e.height=32;e.x=0;e.y=0;e.fillStyle=(new d({alpha:0})).toRGBA();e.strokeStyle=(new d({alpha:1})).toRGBA();e.lineWidth=1;e.lineDash=[];e.state=0;e.i=0;e.j=0;b.call(e);a.bindProperties.apply(e);e.set(f)};a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.prototype.getLine=function(){var e=this;return Math.floor(e.y/e.height)};a.prototype.getColumn=function(){var e=this;return Math.floor(e.x/e.width)};a.bindProperties=function(f){var e=this;e._beforeSet("width",c.validateNumber);e._beforeSet("height",c.validateNumber);e._beforeSet("x",c.validateNumber);e._beforeSet("y",c.validateNumber);e._beforeSet("state",c.validateInt);e._beforeSet("lineDash",c.validateArray);e._beforeSet("fillStyle",c.validateColor);e._beforeSet("strokeStyle",c.validateColor);e._beforeSet("i",c.validateInt);e._beforeSet("j",c.validateInt);e._accessible(["width","height","x","y"])};return a})();CanvasEngine.Grid=(function(){var a=CanvasEngine.RectSet,d=CanvasEngine.AbstractGrid,c=CanvasEngine.Color;var b=function(f){console.log("initializing Grid...");var e=this;e.rectSets=[];e.checkedSets=[];d.call(e,f);b.bindProperties.apply(e)};b.prototype=Object.create(d.prototype);b.prototype.constructor=b;b.bindProperties=function(){var e=this;e._afterChange(function(){var f=false;if(e._isChanged("sw")||e._isChanged("sh")){f=true;e.rectSets=[]}if(e._isChanged("width")||e._isChanged("height")){f=true}if(f){e.update()}})};b.prototype.getAreaInterval=function(n){var m=this;var k=_.isNumber(n.x)?n.x:0;var j=_.isNumber(n.y)?n.y:0;var e=_.isNumber(n.width)?n.width:0;var l=_.isNumber(n.height)?n.height:0;var i=parseInt(Math.floor(j/m.sh));var h=parseInt(Math.floor(k/m.sw));var g=parseInt(Math.floor((j+l)/m.sh));var f=parseInt(Math.floor((k+e)/m.sw));return{si:i,sj:h,ei:g,ej:f}};b.prototype.getRectsFromArea=function(k){var g=[];var f=this;var e=f.getAreaInterval(k);for(var l=e.si;l<=e.ei;l++){if(f.rectSets[l]!==undefined){for(var h=e.sj;h<=e.ej;h++){if(f.rectSets[l][h]!==undefined){g.push(f.rectSets[l][h])}}}}return g};b.prototype.apply=function(f,g){var e=this;e.fillStyle=c.isColor(f.fillStyle)?f.fillStyle:e.fillStyle;e.strokeStyle=c.isColor(f.strokeStyle)?f.strokeStyle:e.strokeStyle;e.rectSets.forEach(function(h){h.forEach(function(i){if(g===undefined||g.apply(i)){i.set(f)}})});return e};b.prototype.update=function(){var q=this;var p=q.sw;var k=q.sh;var n=q.width;var g=q.height;var f;var e;if(n>0&&g>0){var m=Math.floor(n/p);var r=Math.floor(g/k);var l=0;for(f=q.rectSets.length;f<r;f++){if(q.rectSets[f]===undefined){q.rectSets[f]=[]}for(e=q.rectSets[f].length;e<m;e++){l++;q.rectSets[f][e]=new a({x:e*q.sw,y:f*q.sh,width:p,height:k,fillStyle:q.fillStyle,strokeStyle:q.strokeStyle,i:f,j:e})}}for(e=q.rectSets[0].length;e<m;e++){for(f=0;f<q.rectSets.length;f++){l++;q.rectSets[f][e]=new a({x:e*q.sw,y:f*q.sh,width:p,height:k,fillStyle:q.fillStyle,strokeStyle:q.strokeStyle,i:f,j:e})}}for(f=0;f<q.rectSets.length;f++){q.rectSets[f].length=m}q.rectSets.length=Math.min(r,q.rectSets.length)}else{q.rectSets=[]}return q};return b})();CanvasEngine.CE=(function(){var d=CanvasEngine.AppObject,i=CanvasEngine.Math,j=CanvasEngine.MouseReader,h=CanvasEngine.CanvasLayer,a=CanvasEngine.GridLayer,f=CanvasEngine.KeyReader,e=CanvasEngine.Grid,b=$,c=CanvasEngine.Validator;var g=function(l){console.log("initializing canvas engine...");var k=this;k.layers=[];k.height=400;k.width=400;k.viewX=0;k.viewY=0;k.lastViewX=0;k.lastViewY=0;k.width=400;k.mouseReader=null;k.keyReader=null;k.draggable=false;k.scalable=false;k.selectable=false;k.multiSelect=false;k.grid=null;k.scale=1;k.gridLayer=null;k.animationLayer=null;k.areaSelect=null;k.container=null;d.call(k);g.bindProperties.apply(k);k.set(l)};g.prototype=Object.create(d.prototype);g.prototype.constructor=g;g.bindProperties=function(){var k=this;k._onChange("viewX",function(l){k.layers.forEach(function(m){$(m.getElement()).css({left:l})})});k._onChange("viewY",function(l){k.layers.forEach(function(m){$(m.getElement()).css({top:l})})});k._beforeSet("scale",function(){return 1});k._onChange("width",function(l){$(k.container).css({width:l})});k._onChange("height",function(l){$(k.container).css({height:l})});k._onChange("container",function(l){$(l).css({position:"relative",overflow:"hidden",width:k.width,height:k.height}).addClass("transparent-background canvas-engine").on("contextmenu",function(m){m.preventDefault()}).empty();k.getMouseReader().set({element:l});k.keyReader=null});k._beforeSet("container",function(l,m){l=$(l)[0];m=$(m)[0];m=c.validateElement(l,m);if(l!==m){$(l).empty()}return m})};g.prototype.getDrawedArea=function(){var m=this;var l=m.getMouseReader();var s={x:-m.viewX/m.scale,y:-m.viewY/m.scale};var q=i.vpv(i.sdv(m.scale,l.lastDown.left),s);var n=i.vpv(i.sdv(m.scale,l.lastMove),s);var p=Math.abs(n.x-q.x);var k=Math.abs(n.y-q.y);var r={x:q.x,y:q.y,width:p,height:k};r.x=q.x>n.x?r.x-p:r.x;r.y=q.y>n.y?r.y-k:r.y;return r};g.prototype.refreshGridLayer=function(){var k=this;k.getGridLayer().clear().drawGrid(k.getGrid())};g.prototype.onAreaSelect=function(l){var k=this;k.areaSelect=l;return k};g.prototype.updateGrid=function(l){var k=this;k.getGridLayer().set(l).clear().drawGrid(k.getGrid().set(l));return k};g.prototype.redrawGrid=function(){var k=this;k.getGridLayer().clear().drawGrid(k.getGrid());return k};g.prototype.getGridLayer=function(){var k=this;if(k.gridLayer===null){k.gridLayer=k.createLayer({name:"grid-layer"},a)}return k.gridLayer};g.prototype.getGrid=function(){var l=this;if(l.grid===null){var m=l.getWidth();var k=l.getHeight();l.grid=new e({sw:m,sh:k,width:m,height:k})}return l.grid};g.prototype.getMouseReader=function(){var k=this;if(k.mouseReader===null){k.mouseReader=new j({element:k.container});k.mouseReader.onmousedown(3,function(){k.lastViewX=k.viewX;k.lastViewY=k.viewY});k.mouseReader.onmousemove(function(q){var n=this;if(k.draggable&&n.right){var w=n.lastDown.right;var u=n.lastMove;var l=i.vmv(w,u);var v=k.lastViewX-l.x;var s=k.lastViewY-l.y;var m=k.getLayer(0);var t=k.getWidth()-m.width;var r=k.getHeight()-m.height;t=t>0?0:t;r=r>0?0:r;v=Math.min(Math.max(v,t),0);s=Math.min(Math.max(s,r),0);k.set({viewX:v,viewY:s})}});k.mouseReader.onmousedown(1,function(){if(k.selectable&&typeof k.areaSelect==="function"){var l=this;var q={x:Math.abs(k.viewX/k.scale),y:Math.abs(k.viewY/k.scale)};var n=i.vpv(i.sdv(k.scale,l.lastDown.left),q);var p={x:n.x,y:n.y};var m=k.getGrid();k.areaSelect.apply(k,[p,m]);k.refreshGridLayer()}});k.mouseReader.onmousemove(function(p){if(k.multiSelect&&k.selectable&&typeof k.areaSelect==="function"){var l=this;var m=k.getGrid();var n=null;if(l.left){n=k.getDrawedArea()}else{n=i.vpv(i.sdv(k.scale,l.lastMove),{x:-k.viewX/k.scale,y:-k.viewY/k.scale})}k.areaSelect.apply(k,[n,m]);k.refreshGridLayer()}})}return k.mouseReader};g.prototype.getKeyReader=function(){var k=this;if(k.keyReader===null){k.keyReader=new f(k.container)}return k.keyReader};g.prototype.getWidth=function(){return $(this.container).width()};g.prototype.getHeight=function(){return $(this.container).height()};g.prototype.clearAllLayers=function(){var k=this;this.layers.forEach(function(l){if(!(l instanceof a)){l.clear()}});return k};g.prototype.applyToLayers=function(l,m){var k=this;k.layers.forEach(function(n){if(!(n instanceof a)){if(m===undefined||m.apply(n)){n.set(l)}}});return k};g.prototype.createLayer=function(l,p){l=c.validateObject({},l);var m=null;var k=this;l.zIndex=k.layers.length;l.width=c.validateNumber(k.getWidth(),l.width);l.height=c.validateNumber(k.getHeight(),l.height);if(p!==undefined){m=new p(l,k)}else{m=new h(l,k)}k.layers.push(m);if(k.gridLayer!==null){var n=k.layers[k.layers.length-1];k.layers[k.layers.length-1]=k.gridLayer;k.layers[k.gridLayer.zIndex]=n;n.set({zIndex:k.gridLayer.zIndex});k.gridLayer.set({zIndex:k.layers.length-1})}if(k.container!==null){$(k.container).append(m.getElement())}return m};g.prototype.getLayer=function(l){var k=this;if(k.layers[l]!==undefined&&!(k.layers[l] instanceof a)){return k.layers[l]}return null};g.prototype.removeLayers=function(l){var k=this;l.forEach(function(m){k.removeLayer(m)})};g.prototype.removeLayer=function(n){var k=this;var l=-1;if(!(n instanceof a)&&n instanceof h){l=k.layers.indexOf(n)}else{if(c.isInt(n)&&k.layers[n]!==undefined){l=n}}if(l!==-1){k.layers[l].destroy();k.layers.splice(l,1);for(var m=l;m<k.layers.length;m++){k.layers[m].set({zIndex:m})}}return k};g.prototype.renderMap=function(r){var k=this;k.clearAllLayers();var p=r.imageSets;var q=p.length;r.renderIntervals.forEach(function(s){clearInterval(s)});for(var m=0;m<q;m++){if(p[m]!==undefined){var n=p[m].length;for(var l=0;l<n;l++){if(p[m][l]!==undefined){p[m][l].forEach(function(s){r.renderIntervals.push(setTimeout(function(){var t=k.getLayer(s.layer);if(t!==null){t.set({width:r.width*r.tile_w,height:r.height*r.tile_h});t.drawImageSet(s)}},(20*m)+(l*20)))})}}}}r.parent=k};g.createEngine=function(k){return new g(k)};return g})();CanvasEngine.Filter=(function(){var a=CanvasEngine.Color;return{filterList:[],filtering:false,canvas:null,context:null,getCanvas:function(b,d){var c=this;if(c.canvas===null){c.canvas=document.createElement("canvas");c.canvas.width=b;c.canvas.height=d}else{if(b!==undefined&&c.canvas.width!=b){c.canvas.width=b}if(d!==undefined&&c.canvas.height!=d){c.canvas.height=d}}return c.canvas},getPixels:function(d){var e=this.getCanvas(d.width,d.height);var b=e.getContext("2d");b.drawImage(d,0,0);return b.getImageData(0,0,d.width,d.height)},createImageData:function(b,c){return this.getCanvas(b,c).getContext("2d").createImageData(b,c)},applyFilter:function(d,f,i,j){var k=this;if(!k.filtering){k.filtering=true;i=[this.getPixels(f)].concat(i);var b=d.apply(k,i);var e=k.getCanvas(b.width,b.height);var l=e.getContext("2d");l.putImageData(b,0,0);var c=e.toDataURL("image/png");var g=document.createElement("img");g.onload=function(){j(g)};g.src=c;k.filtering=false;if(k.filterList.length>0){var h=k.filterList.shift();k.applyFilter.apply(k,h)}}else{k.filterList.push([d,f,i,j])}},removeColor:function(g,c){var b=this;var f=g.data;var e=f.length;for(var d=0;d<e;d+=4){if(f[d+3]!==0&&f[d]==c.red&&f[d+1]===c.blue&&f[d+2]===c.green){f[d]=255;f[d+1]=255;f[d+2]=255;f[d+3]=0}}return g},trim:function(b){var n=this;var g=b.data;var p=g.length;var j=null;var e=null;var l=null;var c=null;var k=0;var h=0;for(var f=0;f<p;f+=4){if(g[f+3]!==0){k=(f/4)%b.width;h=~~((f/4)/b.width);if(j===null){j=h}if(e===null){e=k}else{if(k<e){e=k}}if(l===null){l=k}else{if(l<k){l=k}}if(c===null){c=h}else{if(c<h){c=h}}}}var m=c-j;var d=l-e;return{x:e,y:j,width:d,height:m}},convolute:function(z,G,k){var d=Math.round(Math.sqrt(G.length));var i=Math.floor(d/2);var j=z.data;var A=z.width;var J=z.height;var q=A;var E=J;var l=this.createImageData(q,E);var K=l.data;var s=k?1:0;for(var m=0;m<E;m++){for(var n=0;n<q;n++){var u=m;var v=n;var B=(m*q+n)*4;var t=0,F=0,H=0,I=0;for(var e=0;e<d;e++){for(var f=0;f<d;f++){var C=u+e-i;var D=v+f-i;if(C>=0&&C<J&&D>=0&&D<A){var p=(C*A+D)*4;var c=G[e*d+f];t+=j[p]*c;F+=j[p+1]*c;H+=j[p+2]*c;I+=j[p+3]*c}}}K[B]=t;K[B+1]=F;K[B+2]=H;K[B+3]=I+s*(255-I)}}return l},invert:function(d){var c=d.data;for(var b=0;b<c.length;b+=4){c[b]=255-c[b];c[b+1]=255-c[b+1];c[b+2]=255-c[b+2]}return d}}})();CanvasEngine.ImageSet=(function(){var b=CanvasEngine.AppObject,c=CanvasEngine.Validator;var a=function(e){var d=this;d.loads=[];d.url="";d.x=0;d.y=0;d.oldX=0;d.oldY=0;d.width=0;d.height=0;d.sx=0;d.sy=0;d.sWidth=0;d.sHeight=0;d.layer=0;d.loaded=false;d.image=null;d.parent=null;d.selected=false;b.call(d);a.bindProperties.apply(d);d.set(e)};a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.prototype.clone=function(){return new a(this._props())};a.prototype.getBounds=function(){var d=this;return{x:d.x,y:d.y,width:d.width,height:d.height}};a.bindProperties=function(){var d=this;d._beforeSet("x",c.validateNumber);d._beforeSet("y",c.validateNumber);d._beforeSet("width",c.validateNumber);d._beforeSet("height",c.validateNumber);d._beforeSet("sx",c.validateNumber);d._beforeSet("sy",c.validateNumber);d._beforeSet("sWidth",c.validateNumber);d._beforeSet("sHeight",c.validateNumber);d._beforeSet("layer",c.validateNumber);d._beforeSet("url",c.validateString);d._accessible(["url","x","y","width","height","sx","sy","sWidth","sHeight","layer"])};a.prototype.isLoaded=function(){return this.loaded};a.prototype.isTransparent=function(d,i){var f=this;if(f.image!==null&&d<f.width&&i<f.height&&d>=0&&i>=0){var g=document.createElement("canvas");g.width=1;g.height=1;var e=g.getContext("2d");e.drawImage(f.image,f.sx+d,f.sy+i,1,1,0,0,1,1);var h=e.getImageData(0,0,1,1).data;return h[3]===undefined||h[3]===0}return true};return a})();CanvasEngine.Map=(function(){var a=CanvasEngine.AppObject,c=CanvasEngine.Validator;var b=function(e){console.log("Initializing Map...");var d=this;d.width=10;d.height=10;d.tile_w=32;d.tile_h=32;d.imageSets=[];d.parent=null;d.renderIntervals=[];a.call(d);b.bindProperties.apply(d);d.set(e)};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.getAreaInterval=function(m){var l=this;var j=c.validateNumber(0,m.x);var i=c.validateNumber(0,m.y);var d=c.validateNumber(0,m.width);var k=c.validateNumber(0,m.height);var h=parseInt(Math.floor(i/l.tile_h));var g=parseInt(Math.floor(j/l.tile_w));var f=parseInt(Math.floor((i+k)/l.tile_h));var e=parseInt(Math.floor((j+d)/l.tile_w));return{si:h,sj:g,ei:f,ej:e}};b.prototype.setTile=function(f,e,g){var d=this;if(d.imageSets[f]===undefined){d.imageSets[f]=[]}if(d.imageSets[f][e]===undefined){d.imageSets[f][e]=[]}d.imageSets[f][e][g.layer]=g;return d};b.prototype.getFullWidth=function(){var d=this;return d.width*d.tile_w};b.prototype.getFullHeight=function(){var d=this;return d.height*d.tile_h};b.bindProperties=function(){var d=this;d._beforeSet("tile_w",c.validateNumber);d._beforeSet("tile_h",c.validateNumber);d._beforeSet("width",c.validateNumber);d._beforeSet("height",c.validateNumber);d._beforeSet("imageSets",c.validateArray);d._afterChange(function(){if(d.parent!==null&&(d._isChanged("tile_w")||d._isChanged("tile_h")||d._isChanged("width")||d._isChanged("height"))){d.parent.applyToLayers({width:d.width*d.tile_w,height:d.height*d.tile_h})}});d._accessible(["width","height","tile_w","tile_h","imageSets"])};return b})();CanvasEngine.ObjectLayer=(function(){var a=CanvasEngine.CanvasLayer,c=CanvasEngine.Animation;var b=function(f,e){var d=this;d.objects=[];a.call(d,f,e)};b.defaultValues={animation:{image:null,x:0,y:0,width:32,height:32,frames:[],speed:5,autoStart:false,repeat:true}};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.add=function(e){var d=this;e.canvasLayer=d;e.layer=d.objects.length;d.objects.push(e);d.refresh();return d};b.prototype.drawObject=function(e){var f=e.getGraphic();var d=this;if(f!=null){d.image(f)}};b.prototype.moveUp=function(g){var e=this;var f=e.objects.indexOf(g);if(f!==-1&&f<e.objects.length-1){var d=e.objects[f+1];d.layer=f;g.layer=f+1;e.objects[f]=d;e.objects[f+1]=g;e.refresh()}return e};b.prototype.moveDown=function(g){var e=this;var f=e.objects.indexOf(g);if(f!==-1&&f>0){var d=e.objects[f-1];d.layer=f;g.layer=f-1;e.objects[f]=d;e.objects[f-1]=g;e.refresh()}return e};b.prototype.remove=function(f){var d=this;var e=d.objects.indexOf(f);if(e!==-1){d.objects.splice(e,1);var h=d.objects.length;for(var g=e;g<h;g++){d.objects[e].layer=e}f.parent=null;d.refresh()}return d};b.prototype.unselectObjects=function(){var d=this;d.objects.forEach(function(e){e.selected=false});d.refresh()};b.prototype.refresh=function(){var d=this;d.clear().objects.forEach(function(e){d.drawObject(e)})};b.prototype.createSpriteAnimation=function(e){var d=this;e=e==undefined?b.defaultValues.animation:_.merge(b.defaultValues.animation,e);var f=new c(e);if(o){}e.frames.forEach(function(g){});if(e.autoStart){f.execute()}d.add(f);return f};return b})();CanvasEngine.createEngine=function(a){return new CanvasEngine.CE(a)};