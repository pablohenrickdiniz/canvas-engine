(function(a){var b={};b.AppObject=(function(){var c=function(){var d=this;d._changeCallbacks=[];d._bfrSet=[];d._changed=[];d._aftChange=[];d._acc=[]};c.validate=true;c.prototype.set=function(e){var d=this;if(e instanceof Object){Object.keys(d).forEach(function(g){if(e[g]!==undefined){var h=e[g];var f=d[g];if(!_.isEqual(f,h)){if(c.validate){if(d._bfrSet===undefined){d._bfrSet={}}if(d._bfrSet[g]!==undefined){h=d._bfrSet[g](f,h)}}if(!_.isEqual(f,h)){d[g]=h;if(d._changed===undefined){d._changed={}}d._changed[g]=true;if(d._changeCallbacks[g]!==undefined){d._changeCallbacks[g](h)}}}}});if(d._aftChange!==undefined&&d._aftChange.length>0&&Object.keys(d._changed).length>0){d._aftChange.forEach(function(f){f()})}d._changed=[]}return d};c.prototype._afterChange=function(e){var d=this;if(d._aftChange===undefined){d._aftChange=[]}d._aftChange.push(e)};c.prototype._isChanged=function(e){var d=this;return d._changed[e]!==undefined};c.prototype._beforeSet=function(e,f){var d=this;if(d[e]!==undefined||d[e]===null){if(d._bfrSet===undefined){d._bfrSet={}}d._bfrSet[e]=f}return d};c.prototype._onChange=function(e,f){var d=this;if(d[e]!==undefined||d[e]===null){if(d._changeCallbacks===undefined){d._changeCallbacks={}}d._changeCallbacks[e]=f}return d};c.prototype._unbindChange=function(e){var d=this;if(d._changeCallbacks!==undefined&&d._changeCallbacks[e]!==undefined){delete d._changeCallbacks[e]}};c.prototype.props=function(){return Object.keys(this)};c.prototype._accessible=function(h){var d=this;var f=arguments.length;if(arguments.length>0){var g=[];for(var e=0;e<f;e++){g.concat(arguments[e])}d._acc={};g.forEach(function(i){if(d[i]!==undefined){d._acc[i]=true}})}else{if(d._acc===undefined){d._acc={}}return Object.keys(d._acc)}};c.prototype._props=function(){var e=this;var d=e._accessible();var f={};d.forEach(function(g){f[g]=e._propsR(e[g])});return f};c.prototype._propsR=function(e){var d=this;if(_.isArray(e)){e=e.map(function(f){return d._propsR(f)})}else{if(e instanceof c){e=e._props()}}return e};return c})();b.Validator=(function(){var c={regex:{PERCENT:/^[0-9]+(\.[0-9]+)?%$/,INT:/^[0-9]+$/,NUMBER:/^-?[0-9]+(\.[0-9]+)?$/,HEXADECIMAL_COLOR:/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?$/,RGB_COLOR:/^rgb\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\)$/,RGBA_COLOR:/^rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(0.[0-9]{1,2}|1)\)$/},validateInt:function(d,e){if(c.regex.INT.test(e)){return e}return d},validateNumber:function(d,e){if(_.isNumber(e)){return e}return d},validateObject:function(d,e){if(_.isObject(e)){return e}return d},validateColor:function(d,e){var f=c.regex;if(e==="transparent"||f.HEXADECIMAL_COLOR.test(e)||f.RGB_COLOR.test(e)||f.RGBA_COLOR.test(e)){return e}return d},validateString:function(d,e){if(_.isString(e)){return e}return d},validateArray:function(d,e){if(_.isArray(e)){return e}return d},validateBoolean:function(d,e){if(_.isBoolean(e)){return e}return d},validateFunction:function(d,e){if(_.isFunction(e)){return e}return d},validateElement:function(d,e){if(_.isElement(e)){return e}return d},isPercent:function(d){return this.regex.PERCENT.test(d)},isInt:function(d){return c.regex.INT.test(d)},isNumber:function(d){}};return c})();b.AbstractGrid=(function(){var c=b.AppObject,d=b.Validator;var e=function(g){console.log("initializing Abstract Grid...");var f=this;f.x=0;f.y=0;f.width=0;f.height=0;f.sw=0;f.sh=0;f.parent=null;f.fillStyle="transparent";f.strokeStyle="#000000";c.call(f);e.bindProperties.apply(f);f.set(g)};e.prototype=Object.create(c.prototype);e.prototype.constructor=e;e.bindProperties=function(){var f=this;f._beforeSet("width",d.validateNumber);f._beforeSet("height",d.validateNumber);f._beforeSet("sh",d.validateNumber);f._beforeSet("sw",d.validateNumber);f._beforeSet("fillStyle",d.validateColor);f._beforeSet("strokeStyle",d.validateColor)};e.prototype.isDrawable=function(){var f=this;return f.sw>0&&f.sh>0&&f.width>0&&f.height>0};return e})();b.IdGenerator=(function(){return{used:[],getUniqueId:function(){var c=this;var d=c.generateUUID();while(c.used[d]!==undefined){d=c.generateUUID()}c.used[d]=true;return d},unlockId:function(d){var c=this;c.free.push(d)},generateUUID:function(){var e=new Date().getTime();var c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var d=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(f=="x"?d:(d&3|8)).toString(16)});return c}}})();b.FrameSync=(function(){(function(){var d=0;var e=["ms","moz","webkit","o"];for(var c=0;c<e.length&&!a.requestAnimationFrame;++c){a.requestAnimationFrame=a[e[c]+"RequestAnimationFrame"];a.cancelAnimationFrame=a[e[c]+"CancelAnimationFrame"]||a[e[c]+"CancelRequestAnimationFrame"]}if(!a.requestAnimationFrame){a.requestAnimationFrame=function(j,g){var f=new Date().getTime();var h=Math.max(0,16-(f-d));var i=a.setTimeout(function(){j(f+h)},h);d=f+h;return i}}if(!a.cancelAnimationFrame){a.cancelAnimationFrame=function(f){clearTimeout(f)}}}());return a.requestAnimationFrame})();b.Frame=(function(){var c=b.AppObject;var d=function(f){var e=this;e.imageSets=[];e.soundEffect=null;e.parent=null;d.bindProperties.apply(e);e.set(f)};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.bindProperties=function(){var e=this;e._accessible(["imageSets"])};d.prototype.add=function(f){var e=this;e.imageSets.push(f)};d.prototype.removeImageSet=function(g){var e=this;var f=e.imageSets.indexOf(g);if(f!==-1){e.imageSets.splice(f,1)}return e};return d})();b.LayerObject=(function(){var c=b.AppObject,e=b.Validator,g=b.Math,d=b.FrameSync;var f=function(i){var h=this;h.x=0;h.y=0;h.lx=0;h.ly=0;h.width=32;h.height=32;h.canvasLayer=null;h.animate_step=null;h.animate_sync=null;c.call(h);f.bindProperties.apply(h)};f.prototype=Object.create(c.prototype);f.prototype.constructor=f;f.bindProperties=function(){var h=this;h._beforeSet("x",e.validateNumber);h._beforeSet("y",e.validateNumber);h._beforeSet("width",e.validateNumber);h._beforeSet("height",e.validateNumber);h._accessible("x","y","width","height")};f.prototype.animate=function(v,o){var s=this;var n=v.x===undefined?s.x:v.x;var l=v.y===undefined?s.y:v.y;var r=v.frameRate===undefined?30:v.frameRate;var i=v.time===undefined?1000:v.time;var t=(r*i)/1000;var h=1000/r;var q=(new Date()).getTime();var j=(new Date()).getTime();var u=(n-s.x)/t;var p=(l-s.y)/t;var m=s.x;var k=s.y;s.stepMove(m,k,u,p,t,h,q,i,r,o)};f.prototype.stepMove=function(m,l,u,t,s,h,r,k,q,o){var p=this;var i=(new Date()).getTime();var n=i-r;if(n<k){var j=(n*q)/1000;p.lx=p.x;p.ly=p.y;p.x=m+u*j;p.y=l+t*j;p.animate_step=setTimeout(function(){a.requestAnimationFrame(function(){p.stepMove(m,l,u,t,s,h,r,k,q,o)});p.refresh()},h)}else{p.lx=p.x;p.ly=p.y;p.x=m+u*s;p.y=l+t*s;p.refresh();clearInterval(p.animate_step);a.cancelAnimationFrame(p.animate_sync);if(o){o()}}};f.prototype.refresh=function(){var h=this;if(h.canvasLayer!=null){h.canvasLayer.clearRect({x:h.lx,y:h.ly,width:h.width,height:h.height}).drawObject(h)}};f.prototype.destroy=function(){var h=this;h.canvasLayer.remove(h)};return f})();b.Animation=(function(){var e=b.FrameSync,d=b.Validator,c=b.AppObject;var f=function(h){var g=this;g.speed=3;g.repeat=false;g.running=false;g.frames=[];g.indexFrame=-1;g.frameInterval=null;g.frameSync=null;g.onStepCall=null;c.call(g);f.bindProperties.apply(g);g.set(h)};f.prototype=Object.create(c.prototype);f.constructor=f;f.bindProperties=function(){var g=this;g._beforeSet("speed",d.validateInt);g._beforeSet("repeat",d.validateBoolean);g._beforeSet("frames",d.validateArray);g._beforeSet("indexFrame",d.validateInt);g._accessible(["speed","repeat","frames"])};f.prototype.execute=function(){var g=this;if(!g.running){g.running=true;g.step(true)}};f.prototype.onStep=function(g){this.onStepCall=g};f.prototype.setSpeed=function(g){this.speed=g};f.prototype.getSpeed=function(){return this.speed};f.prototype.step=function(h){var g=this;if(g.running){g.frameInterval=setTimeout(function(){g.frameSync=e(function(){g.step()});if(g.indexFrame>=g.frames.length-1){g.indexFrame=0}else{g.indexFrame=g.indexFrame+1}if(g.onStepCall!==null){g.onStepCall(g.indexFrame)}if(g.indexFrame>=g.frames.length-1&&!g.repeat){g.pause()}},h?1:1000/(g.speed))}};f.prototype.pause=function(){var g=this;g.running=false;clearInterval(g.frameInterval);a.cancelAnimationFrame(g.frameSync);return g};f.prototype.add=function(h){var g=this;g.frames.push(h);return g};f.prototype.swap=function(j,i){var h=this;if(h.frames[j]!==undefined&&h.frames[i]!==undefined){var g=h.frames[j];h.frames[j]=h.frames[i];h.frames[i]=g}return h};f.prototype.remove=function(h){var g=this;if(h!==-1){g.frames.splice(h,1)}return g};f.prototype.clearFrames=function(){var g=this;g.frames=[];return g};f.prototype.stop=function(){var g=this;g.pause();g.indexFrame=-1;return g};f.prototype.getGraphic=function(){var g=this;if(g.indexFrame!=-1&&g.frames.length>0&&g.frames[g.indexFrame]!=undefined){return g.frames[g.indexFrame]}return null};f.prototype.isRunning=function(){return this.running};f.createFrameSequence=function(j){if(j.steps!=undefined&&_.isNumber(j.steps)){var h=parseInt(j.steps);var n=j.stepX===undefined?null:j.stepX;var m=j.stepY===undefined?null:j.stepY;var g=[];for(var k=0;k<h;k++){var l={};if(n!==null){l.sx=k*n}if(m!==null){l.sy=k*m}g.push(l)}return g}return[]};return f})();b.Math=(function(){var c={};c.dot=function(d,e){return Object.keys(d).reduce(function(f,g){return f+d[g]*e[g]},0)};c.vxv=function(d,f){var e={};Object.keys(d).forEach(function(g){e[g]=d[g]*f[g]});return e};c.vdv=function(d,f){var e={};Object.keys(d).forEach(function(g){e[g]=d[g]/f[g]});return e};c.vpv=function(d,f){var e={};Object.keys(d).forEach(function(g){e[g]=d[g]+f[g]});return e};c.vmv=function(d,f){var e={};Object.keys(d).forEach(function(g){e[g]=d[g]-f[g]});return e};c.sxv=function(f,d){var e={};Object.keys(d).forEach(function(g){e[g]=d[g]*f});return e};c.sdv=function(f,d){var e={};Object.keys(d).forEach(function(g){e[g]=d[g]/f});return e};c.mxv=function(e,d){return e.map(function(f){return c.dot(f,d)})};c.cross2=function(d,e){return d.x*e.y-d.y*e.x};c.norm=function(d){return c.sqrt(c.dot(d,d))};c.normalize=function(d){return c.sxv(1/c.norm(d),d)};c.med=function(f,e){var d={};Object.keys(f).forEach(function(g){d[g]=(f[g]+e[g])/2});return d};c.rotate=function(i,h,f){var e=c.degreeToRadians(h);f=f===undefined?{x:0,y:0}:f;var j=Math.cos(e);var g=Math.sin(e);var d=i.x-f.x;var k=i.y-f.y;return[(d*j-k*g)+f.x,(k*j+d*g)+f.y]};c.degreeToRadians=function(d){return d*(Math.PI/180)};c.degreeFromVec=function(e,d){var f=c.radiansFromVec(e,d);return c.radiansToDegree(f)};c.radiansFromVec=function(h,g){var f=c.dot(h,g);var e=c.norm(h);var d=c.norm(g);return Math.acos(f/(e*d))};c.radiansToDegree=function(d){return d*(180/Math.PI)};c.distance=function(e,d){return Math.sqrt(Object.keys(e).reduce(function(f,g){return f+Math.pow(e[g]-d[g],2)},0))};c.clockWiseDegreeFromVec=function(e){var d={x:0,y:-1};var f=c.degreeFromVec(e,d);if(e.x<0){f=360-f}return f};c.proportional=function(g,e,d){var f=1;if(e<d){f=d/e;d=g;e=d/f}else{if(e>d){f=e/d;e=g;d=e/f}else{e=g;d=g}}return[e,d]};return c})();b.MouseReader=(function(){var c=b.AppObject,e=$,f=b.Validator;var d=function(h){var g=this;g.leftdown=[];g.rightdown=[];g.middledown=[];g.leftup=[];g.rightup=[];g.middleup=[];g.mousemove=[];g.mouseout=[];g.mouseenter=[];g.element=null;g.initialize();c.call(g);d.bindProperties.apply(g);g.set(h)};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.bindProperties=function(){var g=this;g._beforeSet("element",function(h,i){i=f.validateElement(h,i);if(h!==i){$(h).unbind("mousemove");$(h).unbind("mousedown");$(h).unbind("mousewheel")}return i});g._onChange("element",function(i){g.initializeVars();$(i).mousemove(function(l){l.preventDefault();var m=l.target;var k=l.offsetX;var n=l.offsetY;g.lastMove={x:k,y:n};g.mousemove.forEach(function(o){o.apply(g,[l])})});$(i).mousedown(function(k){k.preventDefault();var l={x:k.offsetX,y:k.offsetY};switch(k.which){case 1:g.left=true;g.lastDown.left=l;g.leftdown.forEach(function(m){m.apply(g,[k])});break;case 2:g.middle=true;g.lastDown.middle=l;g.middledown.forEach(function(m){m.apply(g,[k])});break;case 3:g.right=true;g.lastDown.right=l;g.rightdown.forEach(function(m){m.apply(g,[k])})}});$(i).mouseout(function(k){k.preventDefault();g.left=false;g.right=false;g.middle=false;g.mouseout.forEach(function(l){l.apply(g,[k])})});$(i).mouseenter(function(k){k.preventDefault();g.mouseenter.forEach(function(l){l.apply(g,[k])})});var j=function(k){k.preventDefault();g.lastWheel=k.detail?k.detail*(-120):k.wheelDelta;g.mouseWheel.forEach(function(l){l.apply(g,[k])})};var h=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";if($(i)[0].attachEvent){$(i)[0].attachEvent("on"+h,j)}else{if($(g.element)[0].addEventListener){$(i)[0].addEventListener(h,j,false)}}})};d.prototype.initializeVars=function(){var g=this;g.left=false;g.middle=false;g.right=false;g.lastDown={left:{x:0,y:0},right:{x:0,y:0},middle:{x:0,y:0}};g.lastUp={left:{x:0,y:0},right:{x:0,y:0},middle:{x:0,y:0}};g.lastMove={x:0,y:0};g.lastWheel=0;g.mouseWheel=[]};d.prototype.initialize=function(){var g=this;g.initializeVars();$(document).mouseup(function(h){h.preventDefault();if(g.element!==null){var i={x:h.offsetX,y:h.offsetY};switch(h.which){case 1:g.left=false;g.lastUp.left=i;g.leftup.forEach(function(j){j.apply(g,[h])});break;case 2:g.middle=false;g.lastUp.middle=i;g.middleup.forEach(function(j){j.apply(g,[h])});break;case 3:g.right=false;g.lastUp.right=i;g.rightup.forEach(function(j){j.apply(g,[h])})}}})};d.prototype.onmousewheel=function(h){var g=this;g.mouseWheel.push(h)};d.prototype.onmousedown=function(h,i){var g=this;switch(h){case 1:g.leftdown.push(i);break;case 2:g.middledown.push(i);break;case 3:g.rightdown.push(i)}};d.prototype.onmouseup=function(h,i){var g=this;switch(h){case 1:g.leftup.push(i);break;case 2:g.middleup.push(i);break;case 3:g.rightup.push(i)}};d.prototype.onmousemove=function(h){var g=this;g.mousemove.push(h)};d.prototype.onmouseout=function(h){var g=this;g.mouseout.push(h)};d.prototype.onmouseenter=function(h){var g=this;g.mouseenter.push(h)};d.LEFT=1;d.MIDDLE=2;d.RIGHT=3;return d})();b.Color=(function(){var c=b.AppObject;var d=function(f){var e=this;e.red=0;e.blue=0;e.green=0;e.alpha=1;c.call(e);e.set(f)};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.isTransparent=function(){return this.alpha===0};d.random=function(f){f=f===undefined?false:f;var e=new d({red:Math.floor(Math.random()*255),blue:Math.floor(Math.random()*255),green:Math.floor(Math.random()*255),opacity:Math.random()});if(f){return e.toRGBA()}return e.toHEX()};d.prototype.toRGB=function(){var e=this;if(e.isTransparent()){return"transparent"}return"rgb("+e.red+","+e.blue+","+e.green+")"};d.prototype.toRGBA=function(){var e=this;if(e.isTransparent()){return"transparent"}return"rgba("+e.red+","+e.blue+","+e.green+","+e.alpha+")"};d.prototype.toHEX=function(){var f=this;if(f.isTransparent()){return"transparent"}var i=f.red.toString(16);var h=f.blue.toString(16);var e=f.green.toString(16);i=i.length<2?i+"0":i;h=h.length<2?h+"0":h;e=e.length<2?e+"0":e;return("#"+i+h+e).toUpperCase()};d.prototype.toString=function(){var e=this;if(e.isTransparent()){return"transparent"}return e.toRGBA()};d.prototype.reverse=function(){var e=this;e.red=e.red<128?128+(128-e.red):128-(e.red-128);e.blue=e.blue<128?128+(128-e.blue):128-(e.blue-128);e.green=e.green<128?128+(128-e.green):128-(e.green-128);return e};d.asName=function(){var e=this;if(e.isTransparent()){return"transparent"}for(var f in d.Name){if(d.Name[f]===e.toHEX()){return f}}return e.toHEX()};d.Name={Snow:"#FFFAFA",GhostWhite:"#F8F8FF",WhiteSmoke:"#F5F5F5",Gainsboro:"#DCDCDC",FloralWhite:"#FFFAF0",OldLace:"#FDF5E6",Linen:"#FAF0E6",AntiqueWhite:"#FAEBD7",PapayaWhip:"#FFEFD5",BlanchedAlmond:"#FFEBCD",Bisque:"#FFE4C4",PeachPuff:"#FFDAB9",NavajoWhite:"#FFDEAD",Moccasin:"#FFE4B5",Cornsilk:"#FFF8DC",Ivory:"#FFFFF0",LemonChiffon:"#FFFACD",Seashell:"#FFF5EE",Honeydew:"#F0FFF0",MintCream:"#F5FFFA",Azure:"#F0FFFF",AliceBlue:"#F0F8FF",lavender:"#E6E6FA",LavenderBlush:"#FFF0F5",MistyRose:"#FFE4E1",White:"#FFFFFF",Black:"#000000",DarkSlateGray:"#2F4F4F",DimGrey:"#696969",SlateGrey:"#708090",LightSlateGray:"#778899",Grey:"#BEBEBE",LightGray:"#D3D3D3",MidnightBlue:"#191970",NavyBlue:"#000080",CornflowerBlue:"#6495ED",DarkSlateBlue:"#483D8B",SlateBlue:"#6A5ACD",MediumSlateBlue:"#7B68EE",LightSlateBlue:"#8470FF",MediumBlue:"#0000CD",RoyalBlue:"#4169E1",Blue:"#0000FF",DodgerBlue:"#1E90FF",DeepSkyBlue:"#00BFFF",SkyBlue:"#87CEEB",LightSkyBlue:"#87CEFA",SteelBlue:"#4682B4",LightSteelBlue:"#B0C4DE",LightBlue:"#ADD8E6",PowderBlue:"#B0E0E6",PaleTurquoise:"#AFEEEE",DarkTurquoise:"#00CED1",MediumTurquoise:"#48D1CC",Turquoise:"#40E0D0",Cyan:"#00FFFF",LightCyan:"#E0FFFF",CadetBlue:"#5F9EA0",MediumAquamarine:"#66CDAA",Aquamarine:"#7FFFD4",DarkGreen:"#006400",DarkOliveGreen:"#556B2F",DarkSeaGreen:"#8FBC8F",SeaGreen:"#2E8B57",MediumSeaGreen:"#3CB371",LightSeaGreen:"#20B2AA",PaleGreen:"#98FB98",SpringGreen:"#00FF7F",LawnGreen:"#7CFC00",Green:"#00FF00",Chartreuse:"#7FFF00",MedSpringGreen:"#00FA9A",GreenYellow:"#ADFF2F",LimeGreen:"#32CD32",YellowGreen:"#9ACD32",ForestGreen:"#228B22",OliveDrab:"#6B8E23",DarkKhaki:"#BDB76B",PaleGoldenrod:"#EEE8AA",LtGoldenrodYello:"#FAFAD2",LightYellow:"#FFFFE0",Yellow:"#FFFF00",Gold:"#FFD700",LightGoldenrod:"#EEDD82",goldenrod:"#DAA520",DarkGoldenrod:"#B8860B",RosyBrown:"#BC8F8F",IndianRed:"#CD5C5C",SaddleBrown:"#8B4513",Sienna:"#A0522D",Peru:"#CD853F",Burlywood:"#DEB887",Beige:"#F5F5DC",Wheat:"#F5DEB3",SandyBrown:"#F4A460",Tan:"#D2B48C",Chocolate:"#D2691E",Firebrick:"#B22222",Brown:"#A52A2A",DarkSalmon:"#E9967A",Salmon:"#FA8072",LightSalmon:"#FFA07A",Orange:"#FFA500",DarkOrange:"#FF8C00",Coral:"#FF7F50",LightCoral:"#F08080",Tomato:"#FF6347",OrangeRed:"#FF4500",Red:"#FF0000",HotPink:"#FF69B4",DeepPink:"#FF1493",Pink:"#FFC0CB",LightPink:"#FFB6C1",PaleVioletRed:"#DB7093",Maroon:"#B03060",MediumVioletRed:"#C71585",VioletRed:"#D02090",Magenta:"#FF00FF",Violet:"#EE82EE",Plum:"#DDA0DD",Orchid:"#DA70D6",MediumOrchid:"#BA55D3",DarkOrchid:"#9932CC",DarkViolet:"#9400D3",BlueViolet:"#8A2BE2",Purple:"#A020F0",MediumPurple:"#9370DB",Thistle:"#D8BFD8",Snow1:"#FFFAFA",Snow2:"#EEE9E9",Snow3:"#CDC9C9",Snow4:"#8B8989",Seashell1:"#FFF5EE",Seashell2:"#EEE5DE",Seashell3:"#CDC5BF",Seashell4:"#8B8682",AntiqueWhite1:"#FFEFDB",AntiqueWhite2:"#EEDFCC",AntiqueWhite3:"#CDC0B0",AntiqueWhite4:"#8B8378",Bisque1:"#FFE4C4",Bisque2:"#EED5B7",Bisque3:"#CDB79E",Bisque4:"#8B7D6B",PeachPuff1:"#FFDAB9",PeachPuff2:"#EECBAD",PeachPuff3:"#CDAF95",PeachPuff4:"#8B7765",NavajoWhite1:"#FFDEAD",NavajoWhite2:"#EECFA1",NavajoWhite3:"#CDB38B",NavajoWhite4:"#8B795E",LemonChiffon1:"#FFFACD",LemonChiffon2:"#EEE9BF",LemonChiffon3:"#CDC9A5",LemonChiffon4:"#8B8970",Cornsilk1:"#FFF8DC",Cornsilk2:"#EEE8CD",Cornsilk3:"#CDC8B1",Cornsilk4:"#8B8878",Ivory1:"#FFFFF0",Ivory2:"#EEEEE0",Ivory3:"#CDCDC1",Ivory4:"#8B8B83",Honeydew1:"#F0FFF0",Honeydew2:"#E0EEE0",Honeydew3:"#C1CDC1",Honeydew4:"#838B83",LavenderBlush1:"#FFF0F5",LavenderBlush2:"#EEE0E5",LavenderBlush3:"#CDC1C5",LavenderBlush4:"#8B8386",SlateGray4:"#6C7B8B",LightSteelBlue1:"#CAE1FF",LightSteelBlue2:"#BCD2EE",LightSteelBlue3:"#A2B5CD",LightSteelBlue4:"#6E7B8B",LightBlue1:"#BFEFFF",LightBlue2:"#B2DFEE",LightBlue3:"#9AC0CD",LightBlue4:"#68838B",LightCyan1:"#E0FFFF",LightCyan2:"#D1EEEE",LightCyan3:"#B4CDCD",LightCyan4:"#7A8B8B",PaleTurquoise1:"#BBFFFF",PaleTurquoise2:"#AEEEEE",PaleTurquoise3:"#96CDCD",PaleTurquoise4:"#668B8B",CadetBlue1:"#98F5FF",CadetBlue2:"#8EE5EE",CadetBlue3:"#7AC5CD",CadetBlue4:"#53868B",Turquoise1:"#00F5FF",Turquoise2:"#00E5EE",Turquoise3:"#00C5CD",Turquoise4:"#00868B",Cyan1:"#00FFFF",Cyan2:"#00EEEE",Cyan3:"#00CDCD",Cyan4:"#008B8B",DarkSlateGray1:"#97FFFF",DarkSlateGray2:"#8DEEEE",DarkSlateGray3:"#79CDCD",DarkSlateGray4:"#528B8B",Aquamarine1:"#7FFFD4",Aquamarine2:"#76EEC6",Aquamarine3:"#66CDAA",Aquamarine4:"#458B74",DarkSeaGreen1:"#C1FFC1",DarkSeaGreen2:"#B4EEB4",DarkSeaGreen3:"#9BCD9B",DarkSeaGreen4:"#698B69",SeaGreen1:"#54FF9F",SeaGreen2:"#4EEE94",MistyRose1:"#FFE4E1",MistyRose2:"#EED5D2",MistyRose3:"#CDB7B5",MistyRose4:"#8B7D7B",Azure1:"#F0FFFF",Azure2:"#E0EEEE",Azure3:"#C1CDCD",Azure4:"#838B8B",SlateBlue1:"#836FFF",SlateBlue2:"#7A67EE",SlateBlue3:"#6959CD",SlateBlue4:"#473C8B",RoyalBlue1:"#4876FF",RoyalBlue2:"#436EEE",RoyalBlue3:"#3A5FCD",RoyalBlue4:"#27408B",Blue1:"#0000FF",Blue2:"#0000EE",Blue3:"#0000CD",Blue4:"#00008B",DodgerBlue1:"#1E90FF",DodgerBlue2:"#1C86EE",DodgerBlue3:"#1874CD",DodgerBlue4:"#104E8B",SteelBlue1:"#63B8FF",SteelBlue2:"#5CACEE",SteelBlue3:"#4F94CD",SteelBlue4:"#36648B",DeepSkyBlue1:"#00BFFF",DeepSkyBlue2:"#00B2EE",DeepSkyBlue3:"#009ACD",DeepSkyBlue4:"#00688B",SkyBlue1:"#87CEFF",SkyBlue2:"#7EC0EE",SkyBlue3:"#6CA6CD",SkyBlue4:"#4A708B",LightSkyBlue1:"#B0E2FF",LightSkyBlue2:"#A4D3EE",LightSkyBlue3:"#8DB6CD",LightSkyBlue4:"#607B8B",SlateGray1:"#C6E2FF",SlateGray2:"#B9D3EE",SlateGray3:"#9FB6CD",Firebrick4:"#8B1A1A",Brown1:"#FF4040",Brown2:"#EE3B3B",Brown3:"#CD3333",Brown4:"#8B2323",Salmon1:"#FF8C69",Salmon2:"#EE8262",Salmon3:"#CD7054",Salmon4:"#8B4C39",LightSalmon1:"#FFA07A",LightSalmon2:"#EE9572",LightSalmon3:"#CD8162",LightSalmon4:"#8B5742",Orange1:"#FFA500",Orange2:"#EE9A00",Orange3:"#CD8500",Orange4:"#8B5A00",DarkOrange1:"#FF7F00",DarkOrange2:"#EE7600",DarkOrange3:"#CD6600",DarkOrange4:"#8B4500",Coral1:"#FF7256",Coral2:"#EE6A50",Coral3:"#CD5B45",Coral4:"#8B3E2F",Tomato1:"#FF6347",Tomato2:"#EE5C42",Tomato3:"#CD4F39",Tomato4:"#8B3626",OrangeRed1:"#FF4500",OrangeRed2:"#EE4000",OrangeRed3:"#CD3700",OrangeRed4:"#8B2500",Red1:"#FF0000",Red2:"#EE0000",Red3:"#CD0000",Red4:"#8B0000",DeepPink1:"#FF1493",DeepPink2:"#EE1289",DeepPink3:"#CD1076",DeepPink4:"#8B0A50",HotPink1:"#FF6EB4",HotPink2:"#EE6AA7",Gold2:"#EEC900",HotPink3:"#CD6090",HotPink4:"#8B3A62",Pink1:"#FFB5C5",Pink2:"#EEA9B8",Pink3:"#CD919E",Pink4:"#8B636C",LightPink1:"#FFAEB9",LightPink2:"#EEA2AD",LightPink3:"#CD8C95",LightPink4:"#8B5F65",PaleVioletRed1:"#FF82AB",PaleVioletRed2:"#EE799F",PaleVioletRed3:"#CD6889",PaleVioletRed4:"#8B475D",Maroon1:"#FF34B3",Maroon2:"#EE30A7",Maroon3:"#CD2990",Maroon4:"#8B1C62",VioletRed1:"#FF3E96",VioletRed2:"#EE3A8C",VioletRed3:"#CD3278",VioletRed4:"#8B2252",Magenta1:"#FF00FF",Magenta2:"#EE00EE",Magenta3:"#CD00CD",Magenta4:"#8B008B",Orchid1:"#FF83FA",Orchid2:"#EE7AE9",Orchid3:"#CD69C9",Orchid4:"#8B4789",Plum1:"#FFBBFF",Plum2:"#EEAEEE",Plum3:"#CD96CD",Plum4:"#8B668B",MediumOrchid1:"#E066FF",MediumOrchid2:"#D15FEE",MediumOrchid3:"#B452CD",MediumOrchid4:"#7A378B",DarkOrchid1:"#BF3EFF",DarkOrchid2:"#B23AEE",DarkOrchid3:"#9A32CD",DarkOrchid4:"#68228B",Purple1:"#9B30FF",Purple2:"#912CEE",SeaGreen3:"#43CD80",SeaGreen4:"#2E8B57",PaleGreen1:"#9AFF9A",PaleGreen2:"#90EE90",PaleGreen3:"#7CCD7C",PaleGreen4:"#548B54",SpringGreen1:"#00FF7F",SpringGreen2:"#00EE76",SpringGreen3:"#00CD66",SpringGreen4:"#008B45",Green1:"#00FF00",Green2:"#00EE00",Green3:"#00CD00",Green4:"#008B00",Chartreuse1:"#7FFF00",Chartreuse2:"#76EE00",Chartreuse3:"#66CD00",Chartreuse4:"#458B00",OliveDrab1:"#C0FF3E",OliveDrab2:"#B3EE3A",OliveDrab3:"#9ACD32",OliveDrab4:"#698B22",DarkOliveGreen1:"#CAFF70",DarkOliveGreen2:"#BCEE68",DarkOliveGreen3:"#A2CD5A",DarkOliveGreen4:"#6E8B3D",Khaki1:"#FFF68F",Khaki2:"#EEE685",Khaki3:"#CDC673",Khaki4:"#8B864E",LightGoldenrod1:"#FFEC8B",LightGoldenrod2:"#EEDC82",LightGoldenrod3:"#CDBE70",LightGoldenrod4:"#8B814C",LightYellow1:"#FFFFE0",LightYellow2:"#EEEED1",LightYellow3:"#CDCDB4",LightYellow4:"#8B8B7A",Yellow1:"#FFFF00",Yellow2:"#EEEE00",Yellow3:"#CDCD00",Yellow4:"#8B8B00",Gold1:"#FFD700",Gold3:"#CDAD00",Gold4:"#8B7500",Goldenrod1:"#FFC125",Goldenrod2:"#EEB422",Goldenrod3:"#CD9B1D",Goldenrod4:"#8B6914",DarkGoldenrod1:"#FFB90F",DarkGoldenrod2:"#EEAD0E",DarkGoldenrod3:"#CD950C",DarkGoldenrod4:"#8B658B",RosyBrown1:"#FFC1C1",RosyBrown2:"#EEB4B4",RosyBrown3:"#CD9B9B",RosyBrown4:"#8B6969",IndianRed1:"#FF6A6A",IndianRed2:"#EE6363",IndianRed3:"#CD5555",IndianRed4:"#8B3A3A",Sienna1:"#FF8247",Sienna2:"#EE7942",Sienna3:"#CD6839",Sienna4:"#8B4726",Burlywood1:"#FFD39B",Burlywood2:"#EEC591",Burlywood3:"#CDAA7D",Burlywood4:"#8B7355",Wheat1:"#FFE7BA",Wheat2:"#EED8AE",Wheat3:"#CDBA96",Wheat4:"#8B7E66",Tan1:"#FFA54F",Purple3:"#7D26CD",Purple4:"#551A8B",MediumPurple1:"#AB82FF",MediumPurple2:"#9F79EE",MediumPurple3:"#8968CD",MediumPurple4:"#5D478B",Thistle1:"#FFE1FF",Thistle2:"#EED2EE",Thistle3:"#CDB5CD",Thistle4:"#8B7B8B",grey11:"#1C1C1C",grey21:"#363636",grey31:"#4F4F4F",grey41:"#696969",grey51:"#828282",grey61:"#9C9C9C",grey71:"#B5B5B5",gray81:"#CFCFCF",gray91:"#E8E8E8",DarkGrey:"#A9A9A9",DarkBlue:"#00008B",DarkCyan:"#008B8B",DarkMagenta:"#8B008B",DarkRed:"#8B0000",LightGreen:"#90EE90",Chocolate3:"#CD661D",Chocolate4:"#8B4513",Firebrick1:"#FF3030",Firebrick2:"#EE2C2C",Firebrick3:"#CD2626",Tan2:"#EE9A49",Tan3:"#CD853F",Tan4:"#8B5A2B",Chocolate1:"#FF7F24",Chocolate2:"#EE7621"};d.Patterns={HEXADECIMAL:/^#[0-9A-Fa-f]{3}([0-9A-Fa-f]{3})?$/,RGB:/^rgb\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\)$/,RGBA:/^rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2}),(0.[0-9]{1,2}|1)\)$/,NAME:/^[A-Z][a-zA-z0-9]{2,15}$/};d.isColor=function(e){e=d.parse(e);return e!==null};d.parse=function(k){var h=null;if(typeof k==="string"){var j;var i;var e;if(k==="transparent"){h=new d({alpha:0})}else{if(d.Patterns.HEXADECIMAL.test(k)){k=k.substr(k.indexOf("#")+1,k.length);j=parseInt(k.substr(0,2),16);i=parseInt(k.substr(2,2),16);e=parseInt(k.substr(4,2),16);h=new d({red:j,blue:i,green:i})}else{if(d.Patterns.RGB.test(k)){k=k.replace("rgb(","").replace(")","").split(",");j=parseInt(k[0]);i=parseInt(k[1]);e=parseInt(k[2]);h=new d({red:j,blue:e,green:i})}else{if(d.Patterns.RGBA.test(k)){k=k.replace("rgba(","").replace(")","").split(",");j=parseInt(k[0]);i=parseInt(k[1]);e=parseInt(k[2]);var f=parseFloat(k[3]);h=new d({red:j,blue:e,green:i,alpha:f})}else{if(d.Patterns.NAME.test(k)){h=d.parse(d.Name[k])}}}}}}return h};return d})();b.CanvasLayer=(function(){var e=$,c=b.AppObject,g=b.Color,f=b.Validator;var d=function(j,i){console.log("Canvas Layer initialize...");var h=this;h.type="layer";h.context=null;h.element=null;h.canvas=i;h.zIndex=0;h.width=300;h.height=300;h.left=0;h.top=0;h.savedStates=[];h.name="";h.mouseReader=null;h.opacity=1;h.visible=true;h.backgroundColor="transparent";h.transparentRegex=/^\s*transparent\s*|rgba\((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\s*,\s*0\s*\)\s*$/;c.call(h);d.bindProperties.apply(h);h.set(j)};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.defaultValues={rect:{x:0,y:0,width:10,height:10,backgroundColor:"transparent",borderColor:"black",opacity:100,origin:{x:0,y:0}},circle:{x:0,y:0,radius:10,backgroundColor:"transparent",borderColor:"black",opacity:100,origin:{x:0,y:0}},polygon:{backgroundColor:"transparent",borderColor:"black",origin:{x:0,y:0},opacity:100,points:[]},image:{image:null,sx:0,sy:0,sWidth:"auto",sHeight:"auto",dx:0,dy:0,dWidth:"auto",dHeight:"auto"}};d.bindProperties=function(){var h=this;h._onChange("zIndex",function(i){$(h.getElement()).css({zIndex:i}).data("zindex",i)});h._onChange("opacity",function(i){$(h.getElement()).css({opacity:i}).data("opacity",i)});h._onChange("visible",function(i){if(i){h.show()}else{h.hide()}$(h.getElement()).data("visible",i)});h._onChange("width",function(i){$(h.getElement()).prop("width",i)});h._onChange("height",function(i){$(h.getElement()).prop("height",i)});h._onChange("name",function(i){if(i.length===0){$(h.getElement()).removeAttr("data-name").data("name","")}else{$(h.getElement()).data("name",i)}});h._onChange("left",function(i){$(h.getElement()).css({left:i}).data("left",i)});h._onChange("top",function(i){$(h.getElement()).css({top:i}).data("top",i)});h._onChange("backgroundColor",function(i){$(h.getElement()).css({backgroundColor:i}).data("backgroundColor",i)});h._onChange("element",function(i){h.context=null});h._beforeSet("_aftResize",f.validateFunction);h._beforeSet("opacity",f.validateNumber);h._beforeSet("width",f.validateNumber);h._beforeSet("height",f.validateNumber);h._beforeSet("zIndex",f.validateInt);h._beforeSet("left",f.validateNumber);h._beforeSet("top",f.validateNumber);h._beforeSet("backgroundColor",f.validateColor);h._beforeSet("visible",f.validateBoolean);h._beforeSet("element",f.validateElement)};d.prototype.getVisibleArea=function(){var j=this;var k=Math.min(j.width,j.canvas.getWidth());var i=Math.min(j.height,j.canvas.getHeight());var h=Math.abs(j.canvas.viewX);var l=Math.abs(j.canvas.viewY);return{x:h,y:l,width:k,height:i}};d.prototype.isSetVisible=function(i){var h=this;var j=h.getVisibleArea();return !(i.x+i.width<j.x||j.x+j.width<i.x||i.y+i.height<j.y||j.y+j.height<i.y)};d.prototype.show=function(){var h=this;$(h.getElement()).css({visibility:"visible"});return h};d.prototype.hide=function(){var h=this;$(h.getElement()).css({visibility:"hidden"});return h};d.prototype.saveState=function(k){var i=this;var j=i.getElement().toDataURL("image/png");var h=document.createElement("img");h.src=j;i.savedStates[k]=h;return i};d.prototype.restoreState=function(i){var h=this;var j=h.savedStates[i];if(j!==undefined){h.getContext().drawImage(j,0,0)}return h};d.prototype.clearStates=function(){var h=this;h.savedStates=[];return h};d.prototype.getElement=function(){var h=this;if(h.element===null){h.element=document.createElement("canvas");$(h.element).css({pointerEvents:"none",userSelect:"none",position:"absolute",left:h.left,top:h.top,backgroundColor:h.backgroundColor,opacity:h.opacity})}return h.element};d.prototype.getContext=function(){var h=this;if(h.context===null){h.context=h.getElement().getContext("2d");if(h.context.setLineDash===undefined){h.context.setLineDash=function(){}}}return h.context};d.prototype.destroy=function(){var h=this;$(h.element).remove();if(h.canvas.layers[h.zIndex]!==undefined){delete h.canvas.layers[h.zIndex]}};d.prototype.drawImage=function(){var h=this;var i=h.getContext();i.drawImage.apply(i,arguments);return h};d.prototype.drawImageSet=function(j){var h=this;var i=h.getContext();j.parent=h;i.drawImage(j.image,j.sx,j.sy,j.sWidth,j.sHeight,j.x,j.y,j.width,j.height);if(j.selected){i.strokeStyle="rgba(0,0,100,0.5)";i.setLineDash([5,5]);i.strokeRect(j.x,j.y,j.width,j.height)}return h};d.prototype.clear=function(){var h=this;h.getContext().clearRect(0,0,h.width,h.height);return h};d.prototype.drawAnimation=function(i){var h=this;h.clearRect({x:i.x,y:i.y,width:i.width,height:i.height});if(i.frames[i.indexFrame]!==undefined){var j=i.frames[i.indexFrame];h.image(j)}return h};d.prototype.getPixel=function(m,k){var h=this;var l=h.getContext();var n=l.getImageData(m,k,1,1).data;return new g({red:n[0],green:n[1],blue:n[2],alpha:n[3]})};d.prototype.afterResize=function(i){var h=this;h.set({_aftResize:i})};d.prototype.image=function(s){var q=this;s=s===undefined?d.defaultValues.image:_.merge(d.defaultValues.image,s);var i=s.image;if(i!==null&&i instanceof HTMLImageElement){var m=s.dWidth;var j=s.dHeight;var h=s.sWidth;var k=s.sHeight;var o=s.sx;var n=s.sy;var r=s.dx;var p=s.dy;var l;if(m==="auto"&&j==="auto"){m=i.width;j=i.height}else{if(m==="auto"&&_.isNumber(j)){m=i.width*(j/i.height)}else{if(j==="auto"&&_.isNumber(m)){j=i.height*(m/i.width)}}}if(_.isNumber(s.sWidth)&&s.sWidth>0){h=s.sWidth}else{if(f.isPercent(s.sWidth)){l=parseFloat(s.sWidth.replace("%",""));h=i.width*(l/100)}else{h=i.width}}if(_.isNumber(s.sHeight)&&s.sHeight>0){k=s.sHeight}else{if(f.isPercent(s.sHeight)){l=parseFloat(s.sHeight.replace("%",""));k=i.height*(l/100)}else{k=i.height}}if(f.isPercent(s.dWidth)){l=parseFloat(s.dWidth.replace("%",""));m=h*(l/100)}else{if(_.isNumber(s.dWidth)&&s.dWidth>0){m=s.dWidth}}if(f.isPercent(s.dHeight)){l=parseFloat(s.dHeight.replace("%",""));j=k*(l/100)}else{if(_.isNumber(s.dHeight)&&s.dHeight>0){j=s.dHeight}}if(f.isPercent(o)){l=parseFloat(o.replace("%",""));o=i.width*(l/100)}if(f.isPercent(n)){l=parseFloat(n.replace("%",""));n=i.height*(l/100)}if(m>0&&j>0){this.getContext().drawImage(i,o,n,h,k,r,p,m,j)}}};d.prototype.circle=function(i){var h=this;i=i===undefined?d.defaultValues.circle:_.merge(d.defaultValues.circle,i);var j=h.getContext();j.save();h.setContext(i);j.beginPath();j.arc(i.x,i.y,i.radius,0,2*Math.PI);if(j.fillStyle!==null&&!h.transparentRegex.test(j.fillStyle)){j.fill()}if(j.strokeStyle!==null&&!h.transparentRegex.test(j.strokeStyle)){j.stroke()}j.restore();return h};d.prototype.rect=function(i){var h=this;i=i===undefined?d.defaultValues.rect:_.merge(d.defaultValues.rect,i);var j=h.getContext();j.save();h.setContext(i);if(j.fillStyle!==null&&!h.transparentRegex.test(j.fillStyle)){j.fillRect(i.x,i.y,i.width,i.height)}if(j.strokeStyle!==null&&!h.transparentRegex.test(j.strokeStyle)){j.strokeRect(i.x,i.y,i.width,i.height)}j.restore();return h};d.prototype.clearRect=function(i){var h=this;i=i===undefined?d.defaultValues.rect:_.merge(d.defaultValues.rect,i);var j=h.getContext();j.clearRect(i.x,i.y,i.width,i.height);return h};d.prototype.clearCircle=function(i){var h=this;i=i===undefined?d.defaultValues.circle:_.merge(d.defaultValues.circle,i);var j=h.getContext();j.save();j.arc(i.x,i.y,i.radius,0,Math.PI);j.clip();j.clearRect(i.x-i.radius,i.y-i.radius,i.radius*2,i.radius*2);j.restore();return h};d.prototype.polygon=function(j){var h=this;j=j===undefined?d.defaultValues.polygon:_.merge(d.defaultValues.polygon,j);var m=j.points.length;var l=h.getContext();l.save();h.setContext(j);if(m>0){l.beginPath();var n=j.points[0];l.moveTo(n[0],n[1]);for(var k=1;k<m;k++){n=j.points[k];l.lineTo(n[0],n[1])}l.closePath();if(l.fillStyle!==null&&!h.transparentRegex.test(l.fillStyle)){l.fill()}if(l.strokeStyle!==null&&!h.transparentRegex.test(l.strokeStyle)){l.stroke()}}l.restore();return h};d.prototype.setContext=function(k){var j=this;var l=j.getContext();if(k.backgroundColor!==undefined){l.fillStyle=k.backgroundColor}if(k.borderColor!==undefined){l.strokeStyle=k.borderColor}if(k.lineDash!==undefined){l.setLineDash(k.lineDash)}if(k.opacity!==undefined){l.globalAlpha=k.opacity/100}if(k.origin!==undefined){var i=0;var h=0;if(_.isString(k.origin)){switch(k.origin){case"center":i=k.x+(k.width/2);h=k.y+(k.height/2);break}}else{if(_.isObject(k.origin)){i=k.origin.x;h=k.origin.y}}l.translate(i,h);k.x=k.x-i;k.y=k.y-h}if(k.rotate!==undefined){var m=k.rotate*(Math.PI/180);l.rotate(m)}return j};return d})();b.GridLayer=(function(){var c=b.CanvasLayer,e=b.Color;var d=function(h,g){var f=this;c.call(f,h,g)};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.drawGrid=function(h){var f=this;var g=f.getContext();h.rectSets.forEach(function(i){i.forEach(function(j){g.fillStyle=j.fillStyle;g.strokeStyle=j.strokeStyle;g.setLineDash(j.lineDash);g.lineWidth=j.lineWidth;g.fillRect(j.x,j.y,j.width,j.height);g.strokeRect(j.x,j.y,j.width,j.height)})});h.parent=this;return f};d.prototype.drawAbstractGrid=function(f){var q=this;if(f.isDrawable()){var k=q.getContext();k.fillStyle="transparent";k.strokeStyle=(new e({alpha:0.2})).toRGBA();k.lineWidth=1;k.lineDash=[];var l=q.getVisibleArea();var h=l.x!==0?Math.floor(l.x/f.sw):0;var g=l.y!==0?Math.floor(l.y/f.sh):0;var p=Math.ceil((l.x+l.width)/f.sw);var o=Math.ceil((l.y+l.height)/f.sh);for(var n=h;n<p;n++){for(var m=g;m<o;m++){k.strokeRect((n*f.sw)+f.x,(m*f.sh)+f.y,f.sw,f.sh)}}}return q};d.prototype.drawRectSet=function(g){var f=this;var h=f.getContext();h.fillStyle=g.fillStyle;h.strokeStyle=g.strokeStyle;h.fillRect(g.x,g.y,g.width,g.height);h.strokeRect(g.x,g.y,g.width,g.height);return f};return d})();b.KeyReader=(function(){var c=$;var d=function(f){var e=this;e.element=f;e.deny=false;e.keySequence=[];e.allowedSequences=[];e.lastKeyDown=null;e.lastKeyUp=null;e.onSequenceCallbacks=[];e.initialize()};d.prototype.key=function(e){if(d.Keys[e]!==undefined){return d.Keys[e]}return null};d.prototype.onSequence=function(g,f){var e=this;e.onSequenceCallbacks.push({sequence:g,callback:f})};d.prototype.sequenceIs=function(j,e,g){var f=this;e=e===undefined?false:e;g=g===undefined?false:g;if(g&&j.length!==f.keySequence.length){return false}for(var h=0;h<j.length;h++){if(e){if(j[h]!==f.keySequence[h]){return false}}else{if(f.keySequence.indexOf(j[h])===-1){return false}}}return true};d.prototype.denyAll=function(){this.deny=true};d.prototype.allowAll=function(){this.deny=false};d.prototype.allow=function(){var e=this;var g=arguments.length;for(var f=0;f<g;f++){var h=arguments[f];if(!(h instanceof Array)){h=[h]}e.allowedSequences.push(h)}};d.prototype.initialize=function(){var e=this;$(document).ready(function(){console.log("key reader initialize...");$(e.element).attr("tabindex",1);$(e.element).click(function(){$(this).focus()});$(e.element).keydown(function(h){if(e.keySequence.indexOf(h.which)===-1){e.keySequence.push(h.which)}if(e.deny){var g=e.allowedSequences.length;var j=false;for(var f=0;f<g;f++){var k=e.allowedSequences[f];if(e.sequenceIs(k,false,true)){j=true}}if(!j){h.preventDefault()}}e.onSequenceCallbacks.forEach(function(i){if(e.sequenceIs(i.sequence)){i.callback()}})});$(e.element).keyup(function(g){var f=e.keySequence.indexOf(g.which);if(f!==-1){e.keySequence.splice(f,1)}})})};d.Keys={KEY_GT:190,KEY_LT:188,KEY_DOWN:40,KEY_UP:38,KEY_LEFT:37,KEY_RIGHT:39,KEY_END:35,KEY_BEGIN:36,KEY_BACK_TAB:8,KEY_TAB:9,KEY_SH_TAB:16,KEY_ENTER:13,KEY_ESC:27,KEY_SPACE:32,KEY_DEL:46,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_PLUS:107,KEY_MINUS:109,KEY_PF1:112,KEY_PF2:113,KEY_PF3:114,KEY_PF4:115,KEY_PF5:116,KEY_PF6:117,KEY_PF7:118,KEY_PF8:119,KEY_CTRL:17,KEY_ALT_GR:18,KEY_SBL:221,KEY_SBR:220};return d})();b.RectSet=(function(){var d=b.AppObject,f=b.Color,e=b.Validator;var c=function(h){var g=this;g.width=32;g.height=32;g.x=0;g.y=0;g.fillStyle=(new f({alpha:0})).toRGBA();g.strokeStyle=(new f({alpha:1})).toRGBA();g.lineWidth=1;g.lineDash=[];g.state=0;g.i=0;g.j=0;d.call(g);c.bindProperties.apply(g);g.set(h)};c.prototype=Object.create(d.prototype);c.prototype.constructor=c;c.prototype.getLine=function(){var g=this;return Math.floor(g.y/g.height)};c.prototype.getColumn=function(){var g=this;return Math.floor(g.x/g.width)};c.bindProperties=function(h){var g=this;g._beforeSet("width",e.validateNumber);g._beforeSet("height",e.validateNumber);g._beforeSet("x",e.validateNumber);g._beforeSet("y",e.validateNumber);g._beforeSet("state",e.validateInt);g._beforeSet("lineDash",e.validateArray);g._beforeSet("fillStyle",e.validateColor);g._beforeSet("strokeStyle",e.validateColor);g._beforeSet("i",e.validateInt);g._beforeSet("j",e.validateInt);g._accessible(["width","height","x","y"])};return c})();b.Grid=(function(){var c=b.RectSet,f=b.AbstractGrid,e=b.Color;var d=function(h){console.log("initializing Grid...");var g=this;g.rectSets=[];g.checkedSets=[];f.call(g,h);d.bindProperties.apply(g)};d.prototype=Object.create(f.prototype);d.prototype.constructor=d;d.bindProperties=function(){var g=this;g._afterChange(function(){var h=false;if(g._isChanged("sw")||g._isChanged("sh")){h=true;g.rectSets=[]}if(g._isChanged("width")||g._isChanged("height")){h=true}if(h){g.update()}})};d.prototype.getAreaInterval=function(p){var o=this;var m=_.isNumber(p.x)?p.x:0;var l=_.isNumber(p.y)?p.y:0;var g=_.isNumber(p.width)?p.width:0;var n=_.isNumber(p.height)?p.height:0;var k=parseInt(Math.floor(l/o.sh));var j=parseInt(Math.floor(m/o.sw));var i=parseInt(Math.floor((l+n)/o.sh));var h=parseInt(Math.floor((m+g)/o.sw));return{si:k,sj:j,ei:i,ej:h}};d.prototype.getRectsFromArea=function(m){var k=[];var h=this;var g=h.getAreaInterval(m);for(var n=g.si;n<=g.ei;n++){if(h.rectSets[n]!==undefined){for(var l=g.sj;l<=g.ej;l++){if(h.rectSets[n][l]!==undefined){k.push(h.rectSets[n][l])}}}}return k};d.prototype.apply=function(h,i){var g=this;g.fillStyle=e.isColor(h.fillStyle)?h.fillStyle:g.fillStyle;g.strokeStyle=e.isColor(h.strokeStyle)?h.strokeStyle:g.strokeStyle;g.rectSets.forEach(function(j){j.forEach(function(k){if(i===undefined||i.apply(k)){k.set(h)}})});return g};d.prototype.update=function(){var r=this;var q=r.sw;var m=r.sh;var p=r.width;var l=r.height;var k;var g;if(p>0&&l>0){var o=Math.floor(p/q);var s=Math.floor(l/m);var n=0;for(k=r.rectSets.length;k<s;k++){if(r.rectSets[k]===undefined){r.rectSets[k]=[]}for(g=r.rectSets[k].length;g<o;g++){n++;r.rectSets[k][g]=new c({x:g*r.sw,y:k*r.sh,width:q,height:m,fillStyle:r.fillStyle,strokeStyle:r.strokeStyle,i:k,j:g})}}for(g=r.rectSets[0].length;g<o;g++){for(k=0;k<r.rectSets.length;k++){n++;r.rectSets[k][g]=new c({x:g*r.sw,y:k*r.sh,width:q,height:m,fillStyle:r.fillStyle,strokeStyle:r.strokeStyle,i:k,j:g})}}for(k=0;k<r.rectSets.length;k++){r.rectSets[k].length=o}r.rectSets.length=Math.min(s,r.rectSets.length)}else{r.rectSets=[]}return r};return d})();b.CE=(function(){var f=b.AppObject,k=b.Math,l=b.MouseReader,j=b.CanvasLayer,c=b.GridLayer,h=b.KeyReader,g=b.Grid,d=$,e=b.Validator;var i=function(n){console.log("initializing canvas engine...");var m=this;m.layers=[];m.height=400;m.width=400;m.viewX=0;m.viewY=0;m.lastViewX=0;m.lastViewY=0;m.width=400;m.mouseReader=null;m.keyReader=null;m.draggable=false;m.scalable=false;m.selectable=false;m.multiSelect=false;m.grid=null;m.scale=1;m.gridLayer=null;m.animationLayer=null;m.areaSelect=null;m.container=null;f.call(m);i.bindProperties.apply(m);m.set(n)};i.prototype=Object.create(f.prototype);i.prototype.constructor=i;i.bindProperties=function(){var m=this;m._onChange("viewX",function(n){m.layers.forEach(function(o){$(o.getElement()).css({left:n}).data("left",n)})});m._onChange("viewY",function(n){m.layers.forEach(function(o){$(o.getElement()).css({top:n}).data("top",n)})});m._beforeSet("scale",function(){return 1});m._onChange("width",function(n){$(m.container).css({width:n})});m._onChange("height",function(n){$(m.container).css({height:n})});m._onChange("container",function(n){$(n).css({position:"relative",overflow:"hidden",width:m.width,height:m.height}).addClass("transparent-background canvas-engine").on("contextmenu",function(o){o.preventDefault()});$(n).find("canvas").each(function(){var o=$(this).data();if(o.type==="grid-layer"&&m.gridLayer===null){m.gridLayer=m.createLayer({element:this},c)}else{m.createLayer({element:this})}});m.getMouseReader().set({element:n});m.keyReader=null});m._beforeSet("container",function(n,o){n=$(n)[0];o=$(o)[0];o=e.validateElement(n,o);return o})};i.prototype.getDrawedArea=function(){var o=this;var n=o.getMouseReader();var t={x:-o.viewX/o.scale,y:-o.viewY/o.scale};var r=k.vpv(k.sdv(o.scale,n.lastDown.left),t);var p=k.vpv(k.sdv(o.scale,n.lastMove),t);var q=Math.abs(p.x-r.x);var m=Math.abs(p.y-r.y);var s={x:r.x,y:r.y,width:q,height:m};s.x=r.x>p.x?s.x-q:s.x;s.y=r.y>p.y?s.y-m:s.y;return s};i.prototype.refreshGridLayer=function(){var m=this;m.getGridLayer().clear().drawGrid(m.getGrid())};i.prototype.onAreaSelect=function(n){var m=this;m.areaSelect=n;return m};i.prototype.updateGrid=function(n){var m=this;m.getGridLayer().set(n).clear().drawGrid(m.getGrid().set(n));return m};i.prototype.redrawGrid=function(){var m=this;m.getGridLayer().clear().drawGrid(m.getGrid());return m};i.prototype.getGridLayer=function(n){n=n==undefined?{}:n;var m=this;if(m.gridLayer===null){m.gridLayer=m.createLayer({type:"grid",append:n.append,width:n.width,height:n.height},c)}return m.gridLayer};i.prototype.destroyGridLayer=function(){var m=this;if(m.gridLayer!==null){m.gridLayer.destroy();m.gridLayer=null}return m};i.prototype.getGrid=function(){var n=this;if(n.grid===null){var o=n.width;var m=n.height;n.grid=new g({sw:o,sh:m,width:o,height:m})}return n.grid};i.prototype.getMouseReader=function(){var m=this;if(m.mouseReader===null){m.mouseReader=new l({element:m.container});m.mouseReader.onmousedown(3,function(){m.lastViewX=m.viewX;m.lastViewY=m.viewY});m.mouseReader.onmousemove(function(r){var q=this;if(m.draggable&&q.right){var z=q.lastDown.right;var v=q.lastMove;var n=k.vmv(z,v);var w=m.lastViewX-n.x;var t=m.lastViewY-n.y;var o=m.getLayer(0);var u=m.getWidth()-o.width;var s=m.getHeight()-o.height;u=u>0?0:u;s=s>0?0:s;w=Math.min(Math.max(w,u),0);t=Math.min(Math.max(t,s),0);m.set({viewX:w,viewY:t})}});m.mouseReader.onmousedown(1,function(){if(m.selectable&&typeof m.areaSelect==="function"){var n=this;var r={x:Math.abs(m.viewX/m.scale),y:Math.abs(m.viewY/m.scale)};var p=k.vpv(k.sdv(m.scale,n.lastDown.left),r);var q={x:p.x,y:p.y};var o=m.getGrid();m.areaSelect.apply(m,[q,o]);m.refreshGridLayer()}});m.mouseReader.onmousemove(function(q){if(m.multiSelect&&m.selectable&&typeof m.areaSelect==="function"){var n=this;var o=m.getGrid();var p=null;if(n.left){p=m.getDrawedArea()}else{p=k.vpv(k.sdv(m.scale,n.lastMove),{x:-m.viewX/m.scale,y:-m.viewY/m.scale})}m.areaSelect.apply(m,[p,o]);m.refreshGridLayer()}})}return m.mouseReader};i.prototype.getKeyReader=function(){var m=this;if(m.keyReader===null){m.keyReader=new h(m.container)}return m.keyReader};i.prototype.getWidth=function(){return $(this.container).width()};i.prototype.getHeight=function(){return $(this.container).height()};i.prototype.clearAllLayers=function(){var m=this;this.layers.forEach(function(n){n.clear()});return m};i.prototype.applyToLayers=function(n,o){var m=this;m.layers.forEach(function(p){if(o===undefined||o.apply(p)){p.set(n)}});return m};i.prototype.createLayer=function(n,q){n=e.validateObject({},n);var o=null;var m=this;n.zIndex=m.layers.length;n.width=e.validateNumber(m.getWidth(),n.width);n.height=e.validateNumber(m.getHeight(),n.height);n.append=n.append===undefined?true:n.append;if(q!==undefined){o=new q(n,m)}else{o=new j(n,m)}m.layers.push(o);if(m.gridLayer!==null){var p=m.layers[m.layers.length-1];m.layers[m.layers.length-1]=m.gridLayer;m.layers[m.gridLayer.zIndex]=p;p.set({zIndex:m.gridLayer.zIndex});m.gridLayer.set({zIndex:m.layers.length-1})}if(n.append){if(m.container!==null&&!$.contains(m.container,o.getElement())){$(m.container).append(o.getElement())}}return o};i.prototype.getLayer=function(n){var m=this;if(m.layers[n]!==undefined){return m.layers[n]}return null};i.prototype.removeLayers=function(n){var m=this;n.forEach(function(o){m.removeLayer(o)})};i.prototype.removeLayer=function(p){var m=this;var n=-1;if(!(p instanceof c)&&p instanceof j){n=m.layers.indexOf(p)}else{if(e.isInt(p)&&m.layers[p]!==undefined){n=p}}if(n!==-1){m.layers[n].destroy();m.layers.splice(n,1);for(var o=n;o<m.layers.length;o++){m.layers[o].set({zIndex:o})}}return m};i.prototype.renderMap=function(s){var m=this;m.clearAllLayers();var q=s.imageSets;var r=q.length;s.renderIntervals.forEach(function(t){clearInterval(t)});for(var o=0;o<r;o++){if(q[o]!==undefined){var p=q[o].length;for(var n=0;n<p;n++){if(q[o][n]!==undefined){q[o][n].forEach(function(t){s.renderIntervals.push(setTimeout(function(){var u=m.getLayer(t.layer);if(u!==null){u.set({width:s.width*s.tile_w,height:s.height*s.tile_h});u.drawImageSet(t)}},(20*o)+(n*20)))})}}}}s.parent=m};i.createEngine=function(m){return new i(m)};return i})();b.Filter=(function(){var c=b.Color;return{filterList:[],filtering:false,canvas:null,context:null,getCanvas:function(d,f){var e=this;if(e.canvas===null){e.canvas=document.createElement("canvas");e.canvas.width=d;e.canvas.height=f}else{if(d!==undefined&&e.canvas.width!=d){e.canvas.width=d}if(f!==undefined&&e.canvas.height!=f){e.canvas.height=f}}return e.canvas},getPixels:function(e){var f=this.getCanvas(e.width,e.height);var d=f.getContext("2d");d.drawImage(e,0,0);return d.getImageData(0,0,e.width,e.height)},createImageData:function(d,e){return this.getCanvas(d,e).getContext("2d").createImageData(d,e)},applyFilter:function(f,h,k,l){var m=this;if(!m.filtering){m.filtering=true;k=[this.getPixels(h)].concat(k);var d=f.apply(m,k);var g=m.getCanvas(d.width,d.height);var n=g.getContext("2d");n.putImageData(d,0,0);var e=g.toDataURL("image/png");var i=document.createElement("img");i.onload=function(){l(i)};i.src=e;m.filtering=false;if(m.filterList.length>0){var j=m.filterList.shift();m.applyFilter.apply(m,j)}}else{m.filterList.push([f,h,k,l])}},removeColor:function(j,e){var d=this;var h=j.data;var g=h.length;for(var f=0;f<g;f+=4){if(h[f+3]!==0&&h[f]==e.red&&h[f+1]===e.blue&&h[f+2]===e.green){h[f]=255;h[f+1]=255;h[f+2]=255;h[f+3]=0}}return j},trim:function(d){var p=this;var j=d.data;var q=j.length;var l=null;var g=null;var n=null;var e=null;var m=0;var k=0;for(var h=0;h<q;h+=4){if(j[h+3]!==0){m=(h/4)%d.width;k=~~((h/4)/d.width);if(l===null){l=k}if(g===null){g=m}else{if(m<g){g=m}}if(n===null){n=m}else{if(n<m){n=m}}if(e===null){e=k}else{if(e<k){e=k}}}}var o=e-l;var f=n-g;return{x:g,y:l,width:f,height:o}},convolute:function(z,G,l){var e=Math.round(Math.sqrt(G.length));var j=Math.floor(e/2);var k=z.data;var A=z.width;var J=z.height;var q=A;var E=J;var m=this.createImageData(q,E);var K=m.data;var s=l?1:0;for(var n=0;n<E;n++){for(var o=0;o<q;o++){var u=n;var v=o;var B=(n*q+o)*4;var t=0,F=0,H=0,I=0;for(var f=0;f<e;f++){for(var i=0;i<e;i++){var C=u+f-j;var D=v+i-j;if(C>=0&&C<J&&D>=0&&D<A){var p=(C*A+D)*4;var d=G[f*e+i];t+=k[p]*d;F+=k[p+1]*d;H+=k[p+2]*d;I+=k[p+3]*d}}}K[B]=t;K[B+1]=F;K[B+2]=H;K[B+3]=I+s*(255-I)}}return m},invert:function(f){var e=f.data;for(var d=0;d<e.length;d+=4){e[d]=255-e[d];e[d+1]=255-e[d+1];e[d+2]=255-e[d+2]}return f}}})();b.ImageSet=(function(){var e=b.LayerObject,d=b.Validator;var c=function(g){var f=this;f.loads=[];f.sx=0;f.sy=0;f.dx=0;f.dy=0;f.sWidth=0;f.sHeight=0;f.dWidth=0;f.dHeight=0;f.layer=0;f.loaded=false;f.image=null;e.call(f);c.bindProperties.apply(f);f.set(g)};c.prototype=Object.create(e.prototype);c.prototype.constructor=c;c.prototype.clone=function(){return new c(this._props())};c.prototype.getBounds=function(){var f=this;return{x:f.dx,y:f.dy,width:f.dWidth,height:f.dHeight}};c.prototype.getGraphic=function(){var f=this;return{image:f.image,dx:f.dx,dy:f.dy,sx:f.sx,sy:f.sy,sWidth:f.sWidth,sHeight:f.sHeight,dWidth:f.dWidth,dHeight:f.dHeight}};c.bindProperties=function(){};c.prototype.isLoaded=function(){return this.loaded};c.prototype.isTransparent=function(f,k){var h=this;if(h.image!==null&&f<h.width&&k<h.height&&f>=0&&k>=0){var i=document.createElement("canvas");i.width=1;i.height=1;var g=i.getContext("2d");g.drawImage(h.image,h.sx+f,h.sy+k,1,1,0,0,1,1);var j=g.getImageData(0,0,1,1).data;return j[3]===undefined||j[3]===0}return true};return c})();b.Map=(function(){var c=b.AppObject,e=b.Validator;var d=function(g){console.log("Initializing Map...");var f=this;f.width=10;f.height=10;f.tile_w=32;f.tile_h=32;f.imageSets=[];f.parent=null;f.renderIntervals=[];c.call(f);d.bindProperties.apply(f);f.set(g)};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.getAreaInterval=function(o){var n=this;var l=e.validateNumber(0,o.x);var k=e.validateNumber(0,o.y);var f=e.validateNumber(0,o.width);var m=e.validateNumber(0,o.height);var j=parseInt(Math.floor(k/n.tile_h));var i=parseInt(Math.floor(l/n.tile_w));var h=parseInt(Math.floor((k+m)/n.tile_h));var g=parseInt(Math.floor((l+f)/n.tile_w));return{si:j,sj:i,ei:h,ej:g}};d.prototype.setTile=function(h,g,k){var f=this;if(f.imageSets[h]===undefined){f.imageSets[h]=[]}if(f.imageSets[h][g]===undefined){f.imageSets[h][g]=[]}f.imageSets[h][g][k.layer]=k;return f};d.prototype.getFullWidth=function(){var f=this;return f.width*f.tile_w};d.prototype.getFullHeight=function(){var f=this;return f.height*f.tile_h};d.bindProperties=function(){var f=this;f._beforeSet("tile_w",e.validateNumber);f._beforeSet("tile_h",e.validateNumber);f._beforeSet("width",e.validateNumber);f._beforeSet("height",e.validateNumber);f._beforeSet("imageSets",e.validateArray);f._afterChange(function(){if(f.parent!==null&&(f._isChanged("tile_w")||f._isChanged("tile_h")||f._isChanged("width")||f._isChanged("height"))){f.parent.applyToLayers({width:f.width*f.tile_w,height:f.height*f.tile_h})}});f._accessible(["width","height","tile_w","tile_h","imageSets"])};return d})();b.ObjectLayer=(function(){var c=b.CanvasLayer,e=b.Animation;var d=function(h,g){var f=this;f.objects=[];c.call(f,h,g)};d.defaultValues={animation:{x:0,y:0,width:32,height:32,frames:[],speed:5,autoStart:false,repeat:true}};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.add=function(g){var f=this;g.canvasLayer=f;g.layer=f.objects.length;f.objects.push(g);return f};d.prototype.drawObject=function(g){var h=g.getGraphic();var f=this;if(h!==null){f.image(h)}if(g.selected){f.rect({x:g.dx,y:g.dy,width:g.dWidth,height:g.dHeight,lineDash:[4,4]})}};d.prototype.moveUp=function(i){var g=this;var h=g.objects.indexOf(i);if(h!==-1&&h<g.objects.length-1){var f=g.objects[h+1];f.layer=h;i.layer=h+1;g.objects[h]=f;g.objects[h+1]=i;g.refresh()}return g};d.prototype.moveDown=function(i){var g=this;var h=g.objects.indexOf(i);if(h!==-1&&h>0){var f=g.objects[h-1];f.layer=h;i.layer=h-1;g.objects[h]=f;g.objects[h-1]=i;g.refresh()}return g};d.prototype.remove=function(h){var f=this;var g=f.objects.indexOf(h);if(g!==-1){f.objects.splice(g,1);var k=f.objects.length;for(var j=g;j<k;j++){f.objects[g].layer=g}f.refresh()}return f};d.prototype.unselectObjects=function(){var f=this;f.objects.forEach(function(g){g.selected=false});f.refresh()};d.prototype.refresh=function(){var f=this;f.clear().objects.forEach(function(g){f.drawObject(g)})};d.prototype.createSpriteAnimation=function(g){var f=this;g=g===undefined?_.copy(d.defaultValues.animation):_.merge(d.defaultValues.animation,g);if(g.defaultOptions!==undefined){var j=g.frames.length;for(var h=0;h<j;h++){g.frames[h]=_.merge(g.frames[h],g.defaultOptions)}delete g.defaultOptions}var k=new e(g);if(g.autoStart){k.execute()}f.add(k);return k};d.prototype.drawQuadTree=function(g){var f=this;g.objects.forEach(function(h){f.rect(h)});g.nodes.forEach(function(h){f.drawQuadTree(h)})};return d})();b.createEngine=function(c){return new b.CE(c)};a.CE=b})(window);