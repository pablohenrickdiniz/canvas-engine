define(["lodash","IdGenerator"],function(c,b){var a=function(){var d=this;d._changeCallbacks=[];d._bfrSet=[];d._changed=[];d._aftChange=[];d._acc=[]};a.validate=true;a.prototype.set=function(e){var d=this;if(e instanceof Object){Object.keys(d).forEach(function(g){if(e[g]!==undefined){var h=e[g];var f=d[g];if(!c.isEqual(f,h)){if(a.validate){if(d._bfrSet===undefined){d._bfrSet={}}if(d._bfrSet[g]!==undefined){h=d._bfrSet[g](f,h)}}if(!c.isEqual(f,h)){d[g]=h;if(d._changed===undefined){d._changed={}}d._changed[g]=true;if(d._changeCallbacks[g]!==undefined){d._changeCallbacks[g](h)}}}}});if(d._aftChange!==undefined&&d._aftChange.length>0&&Object.keys(d._changed).length>0){d._aftChange.forEach(function(f){f()})}d._changed=[]}return d};a.prototype._afterChange=function(e){var d=this;if(d._aftChange===undefined){d._aftChange=[]}d._aftChange.push(e)};a.prototype._isChanged=function(e){var d=this;return d._changed[e]!==undefined};a.prototype._beforeSet=function(e,f){var d=this;if(d[e]!==undefined||d[e]===null){if(d._bfrSet===undefined){d._bfrSet={}}d._bfrSet[e]=f}return d};a.prototype._onChange=function(e,f){var d=this;if(d[e]!==undefined||d[e]===null){if(d._changeCallbacks===undefined){d._changeCallbacks={}}d._changeCallbacks[e]=f}return d};a.prototype._unbindChange=function(e){var d=this;if(d._changeCallbacks!==undefined&&d._changeCallbacks[e]!==undefined){delete d._changeCallbacks[e]}};a.prototype.props=function(){return Object.keys(this)};a.prototype._accessible=function(e){var d=this;if(e!==undefined){d._acc={};e.forEach(function(f){if(d[f]!==undefined){d._acc[f]=true}})}else{if(d._acc===undefined){d._acc={}}return Object.keys(d._acc)}};a.prototype._props=function(){var e=this;var d=e._accessible();var f={};d.forEach(function(g){f[g]=e._propsR(e[g])});return f};a.prototype._propsR=function(e){var d=this;if(c.isArray(e)){e=e.map(function(f){return d._propsR(f)})}else{if(e instanceof a){e=e._props()}}return e};return a});