define(["lodash"],function(b){var a=function(){var c=this;c._changeCallbacks=[];c._bfrSet=[];c._changed=[];c._aftChange=[]};a.id=0;a.prototype._uniqueId=function(){var c=this;if(c._id===undefined){c._id=++a.id}return c._id};a.prototype.set=function(d){var c=this;if(d instanceof Object){var e=c._uniqueId();Object.keys(c).forEach(function(g){if(d[g]!==undefined){var h=d[g];var f=c[g];if(!b.isEqual(f,h)){if(c._bfrSet[e]===undefined){c._bfrSet[e]={}}if(c._bfrSet[e][g]!==undefined){h=c._bfrSet[e][g](f,h)}if(!b.isEqual(f,h)){c[g]=h;if(c._changed[e]===undefined){c._changed[e]={}}c._changed[e][g]=true;if(c._changeCallbacks[e]===undefined){c._changeCallbacks[e]={}}if(c._changeCallbacks[e][g]!==undefined){c._changeCallbacks[e][g](h)}}}}});if(c._aftChange[e]!==undefined&&c._aftChange[e].length>0&&Object.keys(c._changed[e]).length>0){c._aftChange[e].forEach(function(f){f()})}c._changed[e]=[]}return c};a.prototype._afterChange=function(e){var c=this;var d=c._uniqueId();if(c._aftChange[d]===undefined){c._aftChange[d]=[]}c._aftChange[d].push(e)};a.prototype._isChanged=function(d){var c=this;var e=c._uniqueId();return c._changed[e][d]!==undefined};a.prototype._beforeSet=function(d,f){var c=this;var e=c._uniqueId();if(c[d]!==undefined||c[d]===null){if(c._bfrSet[e]===undefined){c._bfrSet[e]={}}c._bfrSet[e][d]=f}return c};a.prototype._onChange=function(d,f){var c=this;var e=c._uniqueId();if(c[d]!==undefined||c[d]===null){if(c._changeCallbacks[e]===undefined){c._changeCallbacks[e]={}}c._changeCallbacks[e][d]=f}return c};a.prototype._unbindChange=function(d){var c=this;var e=c._uniqueId();if(c._changeCallbacks[e]!==undefined&&c._changeCallbacks[e][d]!==undefined){delete c._changeCallbacks[e][d]}};a.prototype.props=function(){return Object.keys(this)};return a});