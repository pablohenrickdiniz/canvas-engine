define(["RectSet","AbstractGrid","Color","lodash"],function(a,e,d,c){var b=function(g){console.log("initializing Grid...");var f=this;f.rectSets=[];f.checkedSets=[];e.call(f,g);b.bindProperties.apply(f)};b.prototype=Object.create(e.prototype);b.prototype.constructor=b;b.bindProperties=function(){var f=this;f._afterChange(function(){var g=false;if(f._isChanged("sw")||f._isChanged("sh")){g=true;f.rectSets=[]}if(f._isChanged("width")||f._isChanged("height")){g=true}if(g){f.update()}})};b.prototype.getAreaInterval=function(o){var n=this;var l=c.isNumber(o.x)?o.x:0;var k=c.isNumber(o.y)?o.y:0;var f=c.isNumber(o.width)?o.width:0;var m=c.isNumber(o.height)?o.height:0;var j=parseInt(Math.floor(k/n.sh));var i=parseInt(Math.floor(l/n.sw));var h=parseInt(Math.floor((k+m)/n.sh));var g=parseInt(Math.floor((l+f)/n.sw));return{si:j,sj:i,ei:h,ej:g}};b.prototype.getRectsFromArea=function(l){var h=[];var g=this;var f=g.getAreaInterval(l);for(var m=f.si;m<=f.ei;m++){if(g.rectSets[m]!==undefined){for(var k=f.sj;k<=f.ej;k++){if(g.rectSets[m][k]!==undefined){h.push(g.rectSets[m][k])}}}}return h};b.prototype.apply=function(g,h){var f=this;f.fillStyle=d.isColor(g.fillStyle)?g.fillStyle:f.fillStyle;f.strokeStyle=d.isColor(g.strokeStyle)?g.strokeStyle:f.strokeStyle;f.rectSets.forEach(function(i){i.forEach(function(j){if(h===undefined||h.apply(j)){j.set(g)}})});return f};b.prototype.update=function(){var q=this;var p=q.sw;var l=q.sh;var o=q.width;var k=q.height;var g;var f;if(o>0&&k>0){var n=Math.floor(o/p);var r=Math.floor(k/l);var m=0;for(g=q.rectSets.length;g<r;g++){if(q.rectSets[g]===undefined){q.rectSets[g]=[]}for(f=q.rectSets[g].length;f<n;f++){m++;q.rectSets[g][f]=new a({x:f*q.sw,y:g*q.sh,width:p,height:l,fillStyle:q.fillStyle,strokeStyle:q.strokeStyle,i:g,j:f})}}for(f=q.rectSets[0].length;f<n;f++){for(g=0;g<q.rectSets.length;g++){m++;q.rectSets[g][f]=new a({x:f*q.sw,y:g*q.sh,width:p,height:l,fillStyle:q.fillStyle,strokeStyle:q.strokeStyle,i:g,j:f})}}for(g=0;g<q.rectSets.length;g++){q.rectSets[g].length=n}q.rectSets.length=Math.min(r,q.rectSets.length)}else{q.rectSets=[]}return q};return b});