define(["PropsParser","FrameSync","CanvasLayer"],function(d,b,a){var c=function(f){var e=this;f=f==undefined?{}:f;e.speed=3;e.repeat=false;e.running=false;e.frames=[];e.indexFrame=-1;e.x=0;e.y=0;e.width=32;e.height=32;e.frameInterval=null;e.frameSync=null;e.canvasLayer=null;e.onStepCall=null;e.set(f)};c.prototype.set=function(f){var e=this;e.speed=d.parseInt(f.speed,e.speed);e.repeat=typeof f.repeat=="boolean"?f.repeat:e.repeat;e.frames=d.parseArray(f.frames,e.frames);e.x=d.parseInt(f.x,e.x);e.y=d.parseInt(f.y,e.y);e.width=d.parseInt(f.width,e.width);e.height=d.parseInt(f.height,e.height);e.canvasLayer=f.canvasLayer instanceof a?f.canvasLayer:e.canvasLayer};c.prototype.execute=function(){var e=this;if(!e.running){e.running=true;e.step()}};c.prototype.onStep=function(e){this.onStepCall=e};c.prototype.setSpeed=function(e){this.speed=e};c.prototype.getSpeed=function(){return this.speed};c.prototype.step=function(){var e=this;if(e.running){e.frameInterval=setTimeout(function(){e.frameSync=b(function(){e.step()});if(e.indexFrame>=e.frames.length-1){e.indexFrame=0}else{e.indexFrame=e.indexFrame+1}if(e.canvasLayer!=null){e.canvasLayer.drawAnimation(e)}if(e.onStepCall!=null){e.onStepCall(e.indexFrame)}},1000/(e.speed))}};c.prototype.pause=function(){var e=this;e.running=false;clearInterval(e.frameInterval);window.cancelAnimationFrame(e.frameSync);return e};c.prototype.addFrame=function(f){var e=this;f.parent=e;e.frames.push(f);return e};c.prototype.removeFrame=function(g){var e=this;var f=e.frames.indexOf(g);if(f!=-1){e.frames.splice(f,1)}return e};c.prototype.stop=function(){var e=this;e.pause();e.indexFrame=-1;return e};c.prototype.isRunning=function(){return this.running};c.prototype.toJSON=function(){var e=this;return{speed:e.speed,frames:e.frames.map(function(f){return f.toJSON()}),width:e.width,height:e.height}};return c});