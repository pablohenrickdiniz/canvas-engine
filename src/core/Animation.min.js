define(["AppObject","FrameSync","Validator"],function(a,c,b){var d=function(f){var e=this;e.speed=3;e.repeat=false;e.running=false;e.frames=[];e.indexFrame=-1;e.x=0;e.y=0;e.width=32;e.height=32;e.frameInterval=null;e.frameSync=null;e.canvasLayer=null;e.onStepCall=null;d.bindProperties.apply(e);e.set(f)};d.prototype=new a();d.bindProperties=function(){var e=this;e._beforeSet("speed",b.validateInt);e._beforeSet("repeat",b.validateBoolean);e._beforeSet("frames",b.validateArray);e._beforeSet("indexFrame",b.validateInt);e._beforeSet("x",b.validateNumber);e._beforeSet("y",b.validateNumber);e._beforeSet("width",b.validateNumber);e._beforeSet("height",b.validateNumber)};d.prototype.execute=function(){var e=this;if(!e.running){e.running=true;e.step()}};d.prototype.onStep=function(e){this.onStepCall=e};d.prototype.setSpeed=function(e){this.speed=e};d.prototype.getSpeed=function(){return this.speed};d.prototype.step=function(){var e=this;if(e.running){e.frameInterval=setTimeout(function(){e.frameSync=c(function(){e.step()});if(e.indexFrame>=e.frames.length-1){e.indexFrame=0}else{e.indexFrame=e.indexFrame+1}if(e.canvasLayer!==null){e.canvasLayer.drawAnimation(e)}if(e.onStepCall!==null){e.onStepCall(e.indexFrame)}},1000/(e.speed))}};d.prototype.pause=function(){var e=this;e.running=false;clearInterval(e.frameInterval);window.cancelAnimationFrame(e.frameSync);return e};d.prototype.addFrame=function(f){var e=this;f.parent=e;e.frames.push(f);return e};d.prototype.removeFrame=function(g){var e=this;var f=e.frames.indexOf(g);if(f!==-1){e.frames.splice(f,1)}return e};d.prototype.stop=function(){var e=this;e.pause();e.indexFrame=-1;return e};d.prototype.isRunning=function(){return this.running};d.prototype.toJSON=function(){var e=this;return{speed:e.speed,frames:e.frames.map(function(f){return f.toJSON()}),width:e.width,height:e.height}};return d});