define(["AppObject","FrameSync"],function(a,b){var c=function(e){var d=this;d.speed=3;d.repeat=false;d.running=false;d.frames=[];d.indexFrame=-1;d.x=0;d.y=0;d.width=32;d.height=32;d.frameInterval=null;d.frameSync=null;d.canvasLayer=null;d.onStepCall=null;d.set(e)};c.prototype=new a;c.prototype.execute=function(){var d=this;if(!d.running){d.running=true;d.step()}};c.prototype.onStep=function(d){this.onStepCall=d};c.prototype.setSpeed=function(d){this.speed=d};c.prototype.getSpeed=function(){return this.speed};c.prototype.step=function(){var d=this;if(d.running){d.frameInterval=setTimeout(function(){d.frameSync=b(function(){d.step()});if(d.indexFrame>=d.frames.length-1){d.indexFrame=0}else{d.indexFrame=d.indexFrame+1}if(d.canvasLayer!=null){d.canvasLayer.drawAnimation(d)}if(d.onStepCall!=null){d.onStepCall(d.indexFrame)}},1000/(d.speed))}};c.prototype.pause=function(){var d=this;d.running=false;clearInterval(d.frameInterval);window.cancelAnimationFrame(d.frameSync);return d};c.prototype.addFrame=function(e){var d=this;e.parent=d;d.frames.push(e);return d};c.prototype.removeFrame=function(f){var d=this;var e=d.frames.indexOf(f);if(e!=-1){d.frames.splice(e,1)}return d};c.prototype.stop=function(){var d=this;d.pause();d.indexFrame=-1;return d};c.prototype.isRunning=function(){return this.running};c.prototype.toJSON=function(){var d=this;return{speed:d.speed,frames:d.frames.map(function(e){return e.toJSON()}),width:d.width,height:d.height}};return c});